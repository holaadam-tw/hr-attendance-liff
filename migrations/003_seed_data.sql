-- ============================================================
-- 003_seed_data.sql
-- HR Attendance LIFF — 初始種子資料
-- 執行順序：第 3 個
-- ============================================================
-- 說明：插入系統運作所需的基礎資料。
-- 使用 ON CONFLICT DO NOTHING 確保重複執行不會報錯。

-- ========================
-- 1. 預設班別 shift_types
-- ========================
INSERT INTO shift_types (code, name, start_time, end_time, is_overnight, work_hours, break_minutes, color)
VALUES
    ('DAY',   '日班', '08:00', '17:00', false, 8, 60, '#3B82F6'),
    ('MID',   '中班', '13:00', '22:00', false, 8, 60, '#F59E0B'),
    ('NIGHT', '晚班', '22:00', '07:00', true,  8, 60, '#8B5CF6')
ON CONFLICT DO NOTHING;

-- ========================
-- 2. 加班費規則 overtime_rules（依台灣勞基法）
-- ========================
-- 平日加班
INSERT INTO overtime_rules (rule_type, hour_from, hour_to, multiplier, description)
VALUES
    ('weekday', 0, 2, 1.34, '平日加班前 2 小時（1 又 1/3）'),
    ('weekday', 2, 4, 1.67, '平日加班第 3-4 小時（1 又 2/3）')
ON CONFLICT DO NOTHING;

-- 休息日加班
INSERT INTO overtime_rules (rule_type, hour_from, hour_to, multiplier, description)
VALUES
    ('rest_day', 0, 2, 1.34, '休息日加班前 2 小時'),
    ('rest_day', 2, 8, 1.67, '休息日加班第 3-8 小時'),
    ('rest_day', 8, 12, 2.67, '休息日加班第 9-12 小時')
ON CONFLICT DO NOTHING;

-- 國定假日加班
INSERT INTO overtime_rules (rule_type, hour_from, hour_to, multiplier, description)
VALUES
    ('holiday', 0, 8, 2.0, '國定假日加班 8 小時內（雙倍）'),
    ('holiday', 8, 12, 2.67, '國定假日加班超過 8 小時')
ON CONFLICT DO NOTHING;

-- ========================
-- 3. 勞健保級距 insurance_brackets（2024 年版本）
-- ========================
INSERT INTO insurance_brackets (salary_min, salary_max, insured_amount, labor_rate, labor_employee_share, health_rate, health_employee_share)
VALUES
    (0,      27470,  27470,  0.125, 0.2, 0.0517, 0.3),
    (27471,  27600,  27600,  0.125, 0.2, 0.0517, 0.3),
    (27601,  28800,  28800,  0.125, 0.2, 0.0517, 0.3),
    (28801,  30300,  30300,  0.125, 0.2, 0.0517, 0.3),
    (30301,  31800,  31800,  0.125, 0.2, 0.0517, 0.3),
    (31801,  33300,  33300,  0.125, 0.2, 0.0517, 0.3),
    (33301,  34800,  34800,  0.125, 0.2, 0.0517, 0.3),
    (34801,  36300,  36300,  0.125, 0.2, 0.0517, 0.3),
    (36301,  38200,  38200,  0.125, 0.2, 0.0517, 0.3),
    (38201,  40100,  40100,  0.125, 0.2, 0.0517, 0.3),
    (40101,  42000,  42000,  0.125, 0.2, 0.0517, 0.3),
    (42001,  43900,  43900,  0.125, 0.2, 0.0517, 0.3),
    (43901,  45800,  45800,  0.125, 0.2, 0.0517, 0.3),
    (45801,  48200,  48200,  0.125, 0.2, 0.0517, 0.3),
    (48201,  50600,  50600,  0.125, 0.2, 0.0517, 0.3),
    (50601,  53000,  53000,  0.125, 0.2, 0.0517, 0.3),
    (53001,  55400,  55400,  0.125, 0.2, 0.0517, 0.3),
    (55401,  57800,  57800,  0.125, 0.2, 0.0517, 0.3),
    (57801,  60800,  60800,  0.125, 0.2, 0.0517, 0.3),
    (60801,  63800,  63800,  0.125, 0.2, 0.0517, 0.3),
    (63801,  66800,  66800,  0.125, 0.2, 0.0517, 0.3),
    (66801,  69800,  69800,  0.125, 0.2, 0.0517, 0.3),
    (69801,  72800,  72800,  0.125, 0.2, 0.0517, 0.3),
    (72801,  76500,  76500,  0.125, 0.2, 0.0517, 0.3),
    (76501,  80200,  80200,  0.125, 0.2, 0.0517, 0.3),
    (80201,  83900,  83900,  0.125, 0.2, 0.0517, 0.3),
    (83901,  87600,  87600,  0.125, 0.2, 0.0517, 0.3),
    (87601,  92100,  92100,  0.125, 0.2, 0.0517, 0.3),
    (92101,  96600,  96600,  0.125, 0.2, 0.0517, 0.3),
    (96601,  101100, 101100, 0.125, 0.2, 0.0517, 0.3),
    (101101, 105600, 105600, 0.125, 0.2, 0.0517, 0.3),
    (105601, 110100, 110100, 0.125, 0.2, 0.0517, 0.3),
    (110101, 115500, 115500, 0.125, 0.2, 0.0517, 0.3),
    (115501, 120900, 120900, 0.125, 0.2, 0.0517, 0.3),
    (120901, 126300, 126300, 0.125, 0.2, 0.0517, 0.3),
    (126301, 131700, 131700, 0.125, 0.2, 0.0517, 0.3),
    (131701, 137100, 137100, 0.125, 0.2, 0.0517, 0.3),
    (137101, 142500, 142500, 0.125, 0.2, 0.0517, 0.3),
    (142501, 147900, 147900, 0.125, 0.2, 0.0517, 0.3),
    (147901, 150000, 150000, 0.125, 0.2, 0.0517, 0.3)
ON CONFLICT DO NOTHING;

-- ========================
-- 4. 預設系統設定 system_settings
-- ========================
INSERT INTO system_settings (key, value, description)
VALUES
    ('scheduling_mode', '{"mode":"shift","start":"08:00","end":"17:00"}', '排班模式：shift=排班制, fixed=固定班制'),
    ('max_leave_days', '{"annual":7,"sick":30,"personal":14,"compensatory":999,"maternity":56,"marriage":8}', '各假別上限天數'),
    ('features', '{"salary":true,"leave":true,"overtime":true,"schedule":true,"lunch":true,"bonus":true}', '功能模組開關')
ON CONFLICT (key) DO NOTHING;

-- 記錄此 migration 已執行
INSERT INTO _migrations (filename) VALUES ('003_seed_data.sql')
ON CONFLICT (filename) DO NOTHING;
