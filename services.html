<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ğŸ± æœå‹™åŠŸèƒ½ - å“¡å·¥æœå‹™ä¸­å¿ƒ</title>
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="loadingPage" class="loading-screen">
        <div class="spinner"></div>
        <p>ç³»çµ±è¼‰å…¥ä¸­...</p>
    </div>

    <div class="container">
        <!-- ä¾¿ç•¶è¨‚è³¼é é¢ -->
        <div id="lunchPage" class="page active">
            <button class="btn btn-secondary" onclick="window.location.href='index.html'" style="width:auto;margin-bottom:10px;">â† è¿”å›</button>
            <div class="checkin-page">
                <h2>ğŸ± ä¾¿ç•¶è¨‚è³¼</h2>
                <div class="lunar-notice" id="lunarNotice">ğŸŒ™ æ˜å¤©æ˜¯è¾²æ›†åˆä¸€/åäº”ï¼Œå»ºè­°è¨‚è³¼ç´ é£Ÿ</div>
                
                <div class="lunch-summary">
                    <h3 style="margin-bottom:10px;">ğŸ“Š æ˜æ—¥çµ±è¨ˆ</h3>
                    <div class="stat-row"><span>ç¸½æ•¸</span><span id="totalOrders">0</span></div>
                    <div class="stat-row"><span>ğŸ¥— ç´ é£Ÿ</span><span id="vegCount">0</span></div>
                    <div class="stat-row"><span>ğŸ– è‘·é£Ÿ</span><span id="regularCount">0</span></div>
                </div>

                <div class="form-group"><label>è¨‚è³¼æ—¥æœŸ</label><input type="date" id="lunchDate"></div>
                <div class="form-group"><label><input type="checkbox" id="lunchVegetarian"> æˆ‘è¦è¨‚ç´ é£Ÿä¾¿ç•¶</label></div>
                <div class="form-group"><label>å‚™è¨» (é¸å¡«)</label><input type="text" id="lunchNotes" placeholder="ä¾‹ï¼šä¸è¦é£¯"></div>
                <button class="btn btn-success" onclick="submitLunchOrder()">âœ… ç¢ºèªè¨‚è³¼</button>
            </div>
        </div>

        <!-- ç³»çµ±è¨­å®šé é¢ -->
        <div id="settingsPage" class="page">
            <button class="btn btn-secondary" onclick="window.location.href='index.html'" style="width:auto;margin-bottom:10px;">â† è¿”å›</button>
            <div class="checkin-page">
                <h2>âš™ï¸ ç³»çµ±è¨­å®š</h2>
                
                <div class="lunch-summary">
                    <h3 style="margin-bottom:10px;">ğŸ“ ç›®å‰æ‰“å¡åœ°é»</h3>
                    <div id="locationList">
                        <p style="color:#666;text-align:center;">è¼‰å…¥ä¸­...</p>
                    </div>
                </div>

                <div class="binding-card" style="margin-top: 20px;">
                    <h3 style="margin-bottom:15px;">â• æ–°å¢åœ°é»</h3>
                    <div class="form-group">
                        <label>åœ°é»åç¨±</label>
                        <input type="text" id="newLocName" placeholder="ä¾‹å¦‚ï¼šå°åŒ—åˆ†åº—">
                    </div>
                    <div class="form-group">
                        <label>æ‰“å¡åŠå¾‘ (å…¬å°º)</label>
                        <input type="number" id="newLocRadius" value="300">
                    </div>
                    <div class="form-group">
                        <label>åº§æ¨™ (ç·¯åº¦, ç¶“åº¦)</label>
                        <div style="display:flex; gap:10px;">
                            <input type="text" id="newLocLat" placeholder="ç·¯åº¦" readonly>
                            <input type="text" id="newLocLng" placeholder="ç¶“åº¦" readonly>
                        </div>
                        <button class="btn btn-primary" onclick="getCurrentGPSForSetting()" style="margin-top:10px; font-size:14px; padding:10px;">
                            ğŸ“ æŠ“å–ç›®å‰ä½ç½®
                        </button>
                    </div>
                    <button class="btn btn-success" onclick="addNewLocation()">ğŸ’¾ å„²å­˜æ–°åœ°é»</button>
                </div>

                <div class="form-group" style="margin-top:30px; text-align:center;">
                    <p style="color:#999; font-size:12px;">
                        ç³»çµ±ç‰ˆæœ¬ v9.4.1 (ä¿®å¾©ç‰ˆ)<br>
                        <span style="font-size:10px;">æœ€å¾Œæ›´æ–°ï¼š2026-01-27</span>
                    </p>
                </div>
            </div>
        </div>
    </div>

    <script src="common.js"></script>
    <script>
        // é é¢åˆ‡æ›åŠŸèƒ½
        function showPage(id) {
            document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            
            if(id==='lunchPage') loadLunchSummary();
            if(id==='settingsPage') renderLocationList();
        }

        // é é¢è¼‰å…¥å®Œæˆå¾Œåˆå§‹åŒ–
        window.addEventListener('load', async () => {
            // ç¢ºä¿ common.js ä¸­çš„å‡½æ•¸å·²è¼‰å…¥
            if (typeof initializeLiff === 'undefined') {
                console.error('initializeLiff å‡½æ•¸æœªå®šç¾©ï¼Œè«‹æª¢æŸ¥ common.js æ˜¯å¦æ­£ç¢ºè¼‰å…¥');
                return;
            }
            
            // æ ¹æ“š hash æ±ºå®šé¡¯ç¤ºå“ªå€‹é é¢
            const hash = window.location.hash || '#lunch';
            let pageId = 'lunchPage';
            
            if (hash === '#settings') pageId = 'settingsPage';

            const initialized = await initializeLiff();
            if (initialized) {
                const isLoggedIn = await checkUserStatus();
                if (isLoggedIn) {
                    initBottomNav();
                    showPage(pageId);
                } else {
                    window.location.href = 'index.html';
                }
            }
        });
    </script>
    <!-- åº•éƒ¨å°èˆªåˆ— -->
    <nav class="bottom-nav" style="display:none;">
        <a class="nav-item" onclick="window.location.href='index.html'">
            <span class="nav-icon">ğŸ </span><span class="nav-label">é¦–é </span>
        </a>
        <a class="nav-item" onclick="window.location.href='schedule.html'">
            <span class="nav-icon">ğŸ“…</span><span class="nav-label">ç­è¡¨</span>
        </a>
        <a class="nav-item" onclick="window.location.href='checkin.html?type=in'">
            <span class="nav-icon">ğŸ“</span><span class="nav-label">æ‰“å¡</span>
        </a>
        <a class="nav-item" onclick="window.location.href='salary.html'">
            <span class="nav-icon">ğŸ’°</span><span class="nav-label">è–ªè³‡</span>
        </a>
        <a class="nav-item active">
            <span class="nav-icon">âš™ï¸</span><span class="nav-label">è¨­å®š</span>
        </a>
    </nav>

</body>
</html>
