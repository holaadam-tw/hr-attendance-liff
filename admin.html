<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ğŸ‘‘ ç®¡ç†å¾Œå° - å“¡å·¥æœå‹™ä¸­å¿ƒ</title>
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4"></script>
    <link rel="stylesheet" href="style.css">
    <style>
        #lcTable th, #lcTable td, #smTable th, #smTable td { border: 1px solid #F1F5F9; }
        #smTable td:hover { filter: brightness(0.92); }
        #lcTable th, #smTable th { position: sticky; top: 0; background: #fff; z-index: 1; }

        /* ===== èœå–®ç·¨è¼¯å™¨æŠ½å±œ ===== */
        .mi-drawer-mask { position:fixed; top:0; left:0; right:0; bottom:0; background:rgba(0,0,0,0.45); z-index:9000; }
        .mi-drawer { position:fixed; top:0; left:0; right:0; bottom:0; z-index:9001; max-width:520px; margin:0 auto; background:#F8FAFC; display:flex; flex-direction:column; animation:miSlideUp 0.28s ease-out; }
        @keyframes miSlideUp { from { transform:translateY(100%); } to { transform:translateY(0); } }
        .mi-drawer-header { display:flex; align-items:center; justify-content:space-between; padding:12px 16px; background:#fff; border-bottom:1px solid #E2E8F0; flex-shrink:0; }
        .mi-drawer-body { flex:1; overflow-y:auto; padding:16px; -webkit-overflow-scrolling:touch; }
        .mi-drawer-footer { display:flex; gap:10px; padding:12px 16px; background:#fff; border-top:1px solid #E2E8F0; flex-shrink:0; }
        /* åˆ†æ®µå¡ç‰‡ */
        .mi-section { background:#fff; border-radius:14px; border:1.5px solid #E2E8F0; margin-bottom:12px; overflow:hidden; }
        .mi-section-hd { display:flex; align-items:center; justify-content:space-between; padding:13px 16px; cursor:pointer; user-select:none; }
        .mi-section-hd .title { display:flex; align-items:center; gap:8px; font-size:14px; font-weight:800; color:#0F172A; }
        .mi-section-hd .arrow { font-size:11px; color:#94A3B8; transition:transform 0.2s; }
        .mi-section-hd .arrow.open { transform:rotate(180deg); }
        .mi-section-bd { padding:16px; border-top:1px solid #F1F5F9; }
        /* è¡¨å–®æ¬„ä½ */
        .mi-field { margin-bottom:14px; }
        .mi-field label { display:block; font-size:12px; font-weight:700; color:#334155; margin-bottom:5px; }
        .mi-field label .req { color:#DC2626; }
        .mi-field .hint { font-size:11px; color:#94A3B8; margin-top:3px; }
        .mi-input { width:100%; padding:10px 12px; border:1.5px solid #E2E8F0; border-radius:10px; font-size:14px; color:#0F172A; outline:none; box-sizing:border-box; transition:border-color 0.2s; background:#fff; }
        .mi-input:focus { border-color:#4F46E5; }
        .mi-select { width:100%; padding:10px 12px; border:1.5px solid #E2E8F0; border-radius:10px; font-size:14px; color:#0F172A; background:#fff; }
        /* å“é …å¡ç‰‡ */
        .mi-card { display:flex; align-items:center; gap:12px; padding:12px; background:#fff; border-radius:14px; border:1px solid #E2E8F0; margin-bottom:8px; transition:opacity 0.2s; }
        .mi-card.sold-out { opacity:0.55; }
        .mi-card-img { width:56px; height:56px; border-radius:12px; flex-shrink:0; display:flex; align-items:center; justify-content:center; font-size:24px; background:linear-gradient(135deg,#EEF2FF,#F1F5F9); border:1px solid #F1F5F9; overflow:hidden; }
        .mi-card-img img { width:100%; height:100%; object-fit:cover; }
        .mi-card-info { flex:1; min-width:0; }
        .mi-card-info .name { font-size:14px; font-weight:800; color:#0F172A; display:flex; align-items:center; gap:5px; flex-wrap:wrap; }
        .mi-card-info .meta { font-size:12px; color:#64748B; display:flex; align-items:center; gap:6px; margin-top:3px; }
        .mi-card-info .meta .price { font-weight:800; color:#4F46E5; }
        .mi-badge { padding:2px 7px; border-radius:5px; font-size:10px; font-weight:700; white-space:nowrap; }
        .mi-badge-combo { background:#FEF3C7; color:#92400E; }
        .mi-badge-sold { background:#FEE2E2; color:#DC2626; }
        .mi-badge-opt { background:#EEF2FF; color:#4F46E5; }
        /* é¸é …ç¾¤çµ„ç·¨è¼¯å™¨ */
        .og-card { border:1.5px solid #E2E8F0; border-radius:12px; padding:12px; margin-bottom:10px; background:#F8FAFC; }
        .og-header { display:flex; gap:6px; margin-bottom:10px; align-items:center; flex-wrap:wrap; }
        .og-toggle-group { display:flex; background:#F1F5F9; border-radius:8px; overflow:hidden; }
        .og-toggle { padding:5px 10px; border:none; font-size:11px; font-weight:700; cursor:pointer; }
        .og-toggle.active { background:#4F46E5; color:#fff; }
        .og-toggle:not(.active) { background:transparent; color:#64748B; }
        .og-req-btn { padding:5px 10px; border:1.5px solid #E2E8F0; border-radius:8px; font-size:11px; font-weight:700; cursor:pointer; white-space:nowrap; }
        .og-req-btn.on { border-color:#4F46E5; background:#EEF2FF; color:#4F46E5; }
        .og-req-btn.off { border-color:#E2E8F0; background:#fff; color:#94A3B8; }
        .og-del-btn { width:28px; height:28px; border:none; border-radius:8px; background:#FEE2E2; color:#DC2626; font-size:13px; cursor:pointer; display:flex; align-items:center; justify-content:center; flex-shrink:0; }
        .og-choice { display:flex; gap:6px; margin-bottom:6px; align-items:center; padding-left:24px; }
        .og-choice-name { flex:1; padding:7px 10px; border:1px solid #E2E8F0; border-radius:8px; font-size:12px; outline:none; background:#fff; }
        .og-price-wrap { position:relative; width:72px; }
        .og-price-wrap .prefix { position:absolute; left:8px; top:50%; transform:translateY(-50%); font-size:11px; color:#94A3B8; }
        .og-price-wrap input { width:100%; padding:7px 10px 7px 28px; border:1px solid #E2E8F0; border-radius:8px; font-size:12px; outline:none; box-sizing:border-box; background:#fff; }
        /* å®¢äººé è¦½ */
        .mi-preview { background:#F8FAFC; border-radius:16px; padding:16px; border:1.5px solid #E2E8F0; }
        .mi-preview-phone { background:#fff; border-radius:14px; overflow:hidden; box-shadow:0 2px 12px rgba(0,0,0,0.06); border:1px solid #F1F5F9; }
        .mi-preview-img { height:120px; background:linear-gradient(135deg,#EEF2FF,#F1F5F9); display:flex; align-items:center; justify-content:center; font-size:36px; overflow:hidden; }
        .mi-preview-img img { width:100%; height:100%; object-fit:cover; }
        .mi-preview-bd { padding:14px; }
        .mi-tpl-btn { padding:4px 12px; border:1.5px solid #E2E8F0; border-radius:8px; background:#fff; font-size:12px; font-weight:600; color:#475569; cursor:pointer; transition:all 0.15s; }
        .mi-tpl-btn:hover { border-color:#4F46E5; color:#4F46E5; }
    </style>
</head>
<body>
    <div id="loadingPage" class="loading-screen">
        <div class="spinner"></div>
        <p>ç³»çµ±è¼‰å…¥ä¸­...</p>
    </div>

    <div class="container">
        <!-- æ¬Šé™æª¢æŸ¥é é¢ -->
        <div id="permissionPage" class="page active">
            <div class="card">
                <div class="bind-header">
                    <span class="logo">ğŸ”</span>
                    <h2>ç®¡ç†å“¡æ¬Šé™æª¢æŸ¥</h2>
                    <p>æ­£åœ¨é©—è­‰æ‚¨çš„ç®¡ç†å“¡èº«ä»½...</p>
                </div>
                <div id="permissionStatus" class="status-box show info">
                    æª¢æŸ¥æ¬Šé™ä¸­...
                </div>
            </div>
        </div>

        <!-- ç®¡ç†å¾Œå°é¦–é  -->
        <div id="adminHomePage" class="page">
            <div class="user-card">
                <div id="adminCompanyName" style="font-size:13px;font-weight:700;color:#4F46E5;margin-bottom:8px;display:none;"></div>
                <div class="user-info">
                    <div class="avatar" id="adminAvatar">ğŸ‘‘</div>
                    <div class="user-details">
                        <h2 id="adminName">ç®¡ç†å“¡</h2>
                        <p id="adminDept">ç³»çµ±ç®¡ç†</p>
                        <p id="adminId" style="font-size: 11px; opacity: 0.7;">ID: -</p>
                    </div>
                </div>
            </div>

            <div class="menu-grid">
                <div class="menu-item" data-require="admin" onclick="showPage('payrollPage')">
                    <div class="icon">ğŸ’°</div><div class="label">è–ªé…¬ç®¡ç†</div>
                </div>
                <div class="menu-item" data-require="admin" onclick="showPage('locationPage')">
                    <div class="icon">ğŸ“</div><div class="label">åœ°é»ç®¡ç†</div>
                </div>
                <div class="menu-item" onclick="showPage('employeePage')">
                    <div class="icon">ğŸ‘¥</div><div class="label">å“¡å·¥ç®¡ç†</div>
                </div>
                <div class="menu-item" data-require="admin" onclick="showPage('approvalCenterPage')">
                    <div class="icon">ğŸ“‹</div><div class="label">å¯©æ ¸ä¸­å¿ƒ</div>
                </div>
                <div class="menu-item" data-require="admin" onclick="showPage('announcementPage')">
                    <div class="icon">ğŸ“¢</div><div class="label">å…¬å‘Šç®¡ç†</div>
                </div>
                <div class="menu-item" data-require="admin" onclick="showPage('reportPage')">
                    <div class="icon">ğŸ“Š</div><div class="label">å ±è¡¨åŒ¯å‡º</div>
                </div>
                <div class="menu-item" data-require="admin" onclick="showPage('staffMgrPage')">
                    <div class="icon">ğŸ“‹</div><div class="label">äººåŠ›ç®¡ç†</div>
                </div>
                <div class="menu-item" onclick="showPage('lunchMgrPage')">
                    <div class="icon">ğŸ±</div><div class="label">ä¾¿ç•¶ç®¡ç†</div>
                </div>
                <div class="menu-item" data-require="admin" onclick="showPage('clientPage')">
                    <div class="icon">ğŸ¢</div><div class="label">å®¢æˆ¶ç®¡ç†</div>
                </div>
                <div class="menu-item" data-require="admin" data-feature="fieldwork,sales_target" onclick="showPage('fieldSalesAdminPage')">
                    <div class="icon">ğŸ“</div><div class="label">å¤–å‹¤/æ¥­å‹™</div>
                </div>
                <div class="menu-item" data-require="admin" data-feature="store_ordering" onclick="showPage('restaurantPage')">
                    <div class="icon">ğŸ½ï¸</div><div class="label">é¤é£²æ¥­ç®¡ç†</div>
                </div>
                <div class="menu-item" data-require="admin" data-feature="booking" onclick="showPage('bookingMgrPage')">
                    <div class="icon">ğŸ“…</div><div class="label">é ç´„ç®¡ç†</div>
                </div>
                <div class="menu-item" data-require="admin" data-feature="member" onclick="showPage('memberMgrPage')">
                    <div class="icon">ğŸ‘¥</div><div class="label">æœƒå“¡ç®¡ç†</div>
                </div>
                <div class="menu-item" data-require="admin" onclick="showPage('featurePage')">
                    <div class="icon">ğŸ›ï¸</div><div class="label">ç³»çµ±è¨­å®š</div>
                </div>
                <div class="menu-item" onclick="window.location.href='index.html'">
                    <div class="icon">ğŸ </div><div class="label">è¿”å›é¦–é </div>
                </div>
            </div>
        </div>

        <!-- å¹´çµ‚çé‡‘è©¦ç®—é é¢ (æ··åˆç²¾ç®—) -->
        <!-- åœ°é»ç®¡ç†é é¢ -->
        <div id="locationPage" class="page">
            <button class="btn btn-secondary" onclick="showPage('adminHomePage')" style="width:auto;margin-bottom:10px;">â† è¿”å›</button>
            <div class="checkin-page">
                <h2>ğŸ“ åœ°é»ç®¡ç†</h2>
                
                <div class="lunch-summary">
                    <h3 style="margin-bottom:10px;">ğŸ“ ç›®å‰æ‰“å¡åœ°é»</h3>
                    <!-- [BUG FIX] ä½¿ç”¨èˆ‡ common.js ä¸€è‡´çš„ ID -->
                    <div id="locationList">
                        <p style="color:#666;text-align:center;">è¼‰å…¥ä¸­...</p>
                    </div>
                </div>

                <div style="margin-top: 20px; background:#fff; border-radius:16px; padding:20px; box-shadow:0 2px 8px rgba(0,0,0,0.05);">
                    <h3 style="margin-bottom:15px;">â• æ–°å¢åœ°é»</h3>
                    <div class="form-group">
                        <label>åœ°é»åç¨±</label>
                        <!-- [BUG FIX] ä½¿ç”¨èˆ‡ common.js ä¸€è‡´çš„ ID -->
                        <input type="text" id="newLocName" placeholder="ä¾‹å¦‚ï¼šå°åŒ—åˆ†åº—">
                    </div>
                    <div class="form-group">
                        <label>æ‰“å¡åŠå¾‘ (å…¬å°º)</label>
                        <input type="number" id="newLocRadius" value="300">
                    </div>
                    <div class="form-group">
                        <label>åº§æ¨™ (ç·¯åº¦, ç¶“åº¦)</label>
                        <div style="display:flex; gap:10px;">
                            <input type="text" id="newLocLat" placeholder="ç·¯åº¦" readonly>
                            <input type="text" id="newLocLng" placeholder="ç¶“åº¦" readonly>
                        </div>
                        <button class="btn btn-primary" onclick="getCurrentGPSForSetting()" style="margin-top:10px; font-size:14px; padding:10px;">
                            ğŸ“ æŠ“å–ç›®å‰ä½ç½®
                        </button>
                    </div>
                    <button class="btn btn-success" onclick="addNewLocation()">ğŸ’¾ å„²å­˜æ–°åœ°é»</button>
                </div>
            </div>
        </div>

        <!-- å“¡å·¥ç®¡ç†é é¢ -->
        <div id="employeePage" class="page">
            <button class="btn btn-secondary" onclick="showPage('adminHomePage')" style="width:auto;margin-bottom:10px;">â† è¿”å›</button>
            <div class="checkin-page">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px; flex-wrap:wrap; gap:10px;">
                    <h2 style="margin:0;">ğŸ‘¥ å“¡å·¥ç®¡ç†</h2>
                    <div style="display:flex; gap:8px; flex-wrap:wrap;">
                        <button class="btn btn-success" onclick="showAddEmployeeModal()" style="font-size:13px; padding:8px 14px; width:auto; margin:0;">
                            â• æ–°å¢
                        </button>
                        <button class="btn btn-primary" onclick="showJoinQRCode()" style="font-size:13px; padding:8px 14px; width:auto; margin:0;">
                            ğŸ“± QR Code
                        </button>
                    </div>
                </div>
                <div class="form-group" style="margin-bottom:15px;">
                    <input type="text" id="employeeSearch" placeholder="ğŸ” æœå°‹å§“åæˆ–å·¥è™Ÿ" onkeyup="searchEmployees()">
                </div>
                <div id="employeeList">
                    <p style="text-align:center;color:#666;">è¼‰å…¥ä¸­...</p>
                </div>
            </div>
        </div>

        <!-- æ–°å¢å“¡å·¥ Modal -->
        <div id="addEmployeeModal" class="modal" style="display:none;">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>â• æ–°å¢å“¡å·¥</h3>
                    <button class="modal-close" onclick="closeAddEmployeeModal()">&times;</button>
                </div>
                <div class="modal-body">
                    <form id="addEmployeeForm">
                        <div class="form-group">
                            <label>å§“å *</label>
                            <input type="text" id="newEmployeeName" required placeholder="è«‹è¼¸å…¥å“¡å·¥å§“å">
                        </div>
                        <div class="form-group">
                            <label>å·¥è™Ÿ *</label>
                            <input type="text" id="newEmployeeNumber" required placeholder="ä¾‹å¦‚ï¼šE001">
                        </div>
                        <div class="form-group">
                            <label>éƒ¨é–€</label>
                            <select id="newEmployeeDepartment">
                                <option value="ç®¡ç†éƒ¨">ç®¡ç†éƒ¨</option>
                                <option value="æ¥­å‹™éƒ¨">æ¥­å‹™éƒ¨</option>
                                <option value="æŠ€è¡“éƒ¨">æŠ€è¡“éƒ¨</option>
                                <option value="äººäº‹éƒ¨">äººäº‹éƒ¨</option>
                                <option value="è²¡å‹™éƒ¨">è²¡å‹™éƒ¨</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>è·ä½</label>
                            <input type="text" id="newEmployeePosition" placeholder="ä¾‹å¦‚ï¼šå°ˆå“¡">
                        </div>
                        <div class="form-group">
                            <label>é©—è­‰ç¢¼ *</label>
                            <input type="text" id="newEmployeeCode" required placeholder="èº«åˆ†è­‰å¾Œ4ç¢¼æˆ–è‡ªè¨‚é©—è­‰ç¢¼">
                            <small style="color:#666; font-size:12px; display:block; margin-top:5px;">
                                ğŸ’¡ å»ºè­°ä½¿ç”¨èº«åˆ†è­‰å¾Œ4ç¢¼ï¼Œå“¡å·¥ç¶å®šæ™‚éœ€è¦è¼¸å…¥æ­¤é©—è­‰ç¢¼
                            </small>
                        </div>
                        <div class="form-group">
                            <label>åˆ°è·æ—¥æœŸ</label>
                            <input type="date" id="newEmployeeHireDate">
                        </div>
                        <div class="form-group">
                            <label>åƒ±ç”¨é¡å‹</label>
                            <select id="newEmployeeType">
                                <option value="fulltime">æ­£è·</option>
                                <option value="parttime">å…¼è·</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>è§’è‰²æ¬Šé™</label>
                            <select id="newEmployeeRole">
                                <option value="user">ä¸€èˆ¬å“¡å·¥</option>
                                <option value="manager">ä¸»ç®¡</option>
                                <option value="admin">ç®¡ç†å“¡</option>
                            </select>
                        </div>
                        <div style="display:flex; gap:10px; margin-top:20px;">
                            <button type="submit" class="btn btn-success" style="flex:1;">ğŸ’¾ å„²å­˜å“¡å·¥</button>
                            <button type="button" class="btn btn-secondary" onclick="closeAddEmployeeModal()" style="flex:1;">å–æ¶ˆ</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- QR Code Modal -->
        <div id="qrModal" class="modal" style="display:none;">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>ğŸ“± å“¡å·¥åŠ å…¥ QR Code</h3>
                    <button class="modal-close" onclick="closeQRModal()">&times;</button>
                </div>
                <div class="modal-body" style="text-align:center;">
                    <div id="qrcode" style="margin:20px auto; display:inline-block;"></div>
                    <div style="margin-top:20px; padding:15px; background:#f3f4f6; border-radius:12px;">
                        <p style="margin:0; font-size:14px; color:#666;">å…¬å¸ä»£ç¢¼</p>
                        <p style="margin:5px 0; font-size:18px; font-weight:bold; color:#1f2937;">HR_SYSTEM_001</p>
                        <p style="margin:5px 0; font-size:12px; color:#9ca3af;">ç„¡æ³•æƒç¢¼æ™‚è«‹æ‰‹å‹•è¼¸å…¥æ­¤ä»£ç¢¼</p>
                    </div>
                    <div style="margin-top:15px; padding:12px; background:#fef3c7; border-radius:8px; border-left:4px solid #f59e0b; text-align:left;">
                        <p style="margin:0; font-size:13px; color:#92400e;">
                            <strong>ä½¿ç”¨èªªæ˜ï¼š</strong><br>
                            1. å“¡å·¥æƒææ­¤ QR Code<br>
                            2. è¼¸å…¥å·¥è™Ÿå’Œé©—è­‰ç¢¼<br>
                            3. å®Œæˆç¶å®šå³å¯ä½¿ç”¨ç³»çµ±
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- è–ªè³‡è¨­å®š Modal -->
        <div id="salarySettingModal" class="modal" style="display:none;">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>ğŸ’° è–ªè³‡è¨­å®š</h3>
                    <button class="modal-close" onclick="closeSalarySettingModal()">&times;</button>
                </div>
                <div class="modal-body">
                    <div id="salarySettingEmpName" style="font-size:15px;font-weight:800;color:#0F172A;margin-bottom:16px;text-align:center;"></div>
                    <div class="form-group">
                        <label>è¨ˆè–ªæ–¹å¼</label>
                        <select id="ssSalaryType" onchange="onSalaryTypeChange()">
                            <option value="monthly">æœˆè–ªåˆ¶</option>
                            <option value="daily">æ—¥è–ªåˆ¶</option>
                            <option value="hourly">æ™‚è–ªåˆ¶</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label id="ssBaseLabel">åŸºæœ¬æœˆè–ª</label>
                        <input type="text" inputmode="numeric" id="ssBaseSalary" placeholder="ä¾‹å¦‚ï¼š35,000">
                    </div>
                    <div class="form-group">
                        <label>ä¼™é£Ÿæ´¥è²¼ï¼ˆæœˆï¼‰</label>
                        <input type="text" inputmode="numeric" id="ssMealAllowance" placeholder="ä¾‹å¦‚ï¼š2,400" value="0">
                    </div>
                    <div class="form-group">
                        <label>è·å‹™åŠ çµ¦ï¼ˆæœˆï¼‰</label>
                        <input type="text" inputmode="numeric" id="ssPositionAllowance" placeholder="ä¾‹å¦‚ï¼š5,000" value="0">
                    </div>
                    <div class="form-group">
                        <label>å…¨å‹¤çé‡‘</label>
                        <input type="text" inputmode="numeric" id="ssFullAttBonus" placeholder="ä¾‹å¦‚ï¼š2,000" value="0">
                    </div>
                    <div class="form-group">
                        <label>å‹é€€è‡ªæ %</label>
                        <input type="number" id="ssPensionRate" min="0" max="6" placeholder="0~6" value="0">
                    </div>
                    <div style="display:flex;gap:10px;margin-top:20px;">
                        <button onclick="saveSalarySetting()" class="btn btn-success" style="flex:1;">ğŸ’¾ å„²å­˜è–ªè³‡</button>
                        <button onclick="closeSalarySettingModal()" class="btn btn-secondary" style="flex:1;">å–æ¶ˆ</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ç·¨è¼¯å“¡å·¥ Modal -->
        <div id="editEmployeeModal" class="modal" style="display:none;">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>âœï¸ ç·¨è¼¯å“¡å·¥</h3>
                    <button class="modal-close" onclick="closeEditEmployeeModal()">&times;</button>
                </div>
                <div class="modal-body">
                    <input type="hidden" id="editEmpId">
                    <div class="form-group">
                        <label>å§“å</label>
                        <input type="text" id="editEmpName">
                    </div>
                    <div class="form-group">
                        <label>éƒ¨é–€</label>
                        <select id="editEmpDept">
                            <option value="ç®¡ç†éƒ¨">ç®¡ç†éƒ¨</option>
                            <option value="æ¥­å‹™éƒ¨">æ¥­å‹™éƒ¨</option>
                            <option value="æŠ€è¡“éƒ¨">æŠ€è¡“éƒ¨</option>
                            <option value="äººäº‹éƒ¨">äººäº‹éƒ¨</option>
                            <option value="è²¡å‹™éƒ¨">è²¡å‹™éƒ¨</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>è·ä½</label>
                        <select id="editEmpPosition">
                            <option value="">-- é¸æ“‡è·ä½ --</option>
                            <option value="æ¥­å‹™">æ¥­å‹™</option>
                            <option value="è¡Œæ”¿">è¡Œæ”¿</option>
                            <option value="å·¥ç¨‹">å·¥ç¨‹</option>
                            <option value="ä¸»ç®¡">ä¸»ç®¡</option>
                            <option value="å€‰ç®¡">å€‰ç®¡</option>
                            <option value="å®¢æœ">å®¢æœ</option>
                            <option value="æœƒè¨ˆ">æœƒè¨ˆ</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>åˆ°è·æ—¥æœŸ</label>
                        <input type="date" id="editEmpHireDate">
                    </div>
                    <div class="form-group">
                        <label>åƒ±ç”¨é¡å‹</label>
                        <select id="editEmpType">
                            <option value="fulltime">æ­£è·</option>
                            <option value="parttime">å…¼è·</option>
                        </select>
                    </div>
                    <div style="display:flex;gap:10px;margin-top:20px;">
                        <button onclick="saveEditEmployee()" class="btn btn-success" style="flex:1;">ğŸ’¾ å„²å­˜</button>
                        <button onclick="closeEditEmployeeModal()" class="btn btn-secondary" style="flex:1;">å–æ¶ˆ</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- è«‹å‡å¯©æ ¸é é¢ -->
        <!-- ====== å¯©æ ¸ä¸­å¿ƒï¼ˆåˆä½µï¼šè«‹å‡/è£œæ‰“å¡/åŠ ç­/æ›ç­ï¼‰ ====== -->
        <div id="approvalCenterPage" class="page">
            <button class="btn btn-secondary" onclick="showPage('adminHomePage')" style="width:auto;margin-bottom:10px;">â† è¿”å›</button>
            <div class="checkin-page">
                <h2>ğŸ“‹ å¯©æ ¸ä¸­å¿ƒ</h2>
                <!-- å¯©æ ¸é¡å‹åˆ‡æ› -->
                <div style="display:flex;gap:4px;margin-bottom:16px;background:#F1F5F9;border-radius:10px;padding:3px;">
                    <button class="aprTab aprTabActive" onclick="switchApprovalType('leave',this)" style="flex:1;padding:10px;border:none;border-radius:8px;cursor:pointer;font-weight:700;font-size:12px;background:#fff;color:#4F46E5;box-shadow:0 1px 4px rgba(0,0,0,0.08);">âœ… è«‹å‡</button>
                    <button class="aprTab" onclick="switchApprovalType('makeup',this)" style="flex:1;padding:10px;border:none;border-radius:8px;cursor:pointer;font-weight:700;font-size:12px;background:transparent;color:#94A3B8;">ğŸ”§ è£œæ‰“å¡</button>
                    <button class="aprTab" onclick="switchApprovalType('overtime',this)" style="flex:1;padding:10px;border:none;border-radius:8px;cursor:pointer;font-weight:700;font-size:12px;background:transparent;color:#94A3B8;">â° åŠ ç­</button>
                    <button class="aprTab" onclick="switchApprovalType('swap',this)" style="flex:1;padding:10px;border:none;border-radius:8px;cursor:pointer;font-weight:700;font-size:12px;background:transparent;color:#94A3B8;">ğŸ”„ æ›ç­</button>
                </div>

                <!-- è«‹å‡å¯©æ ¸ -->
                <div id="aprLeave" class="aprContent">
                    <div class="tabs" id="leaveApprovalTabs">
                        <button class="tab-btn active" onclick="switchLeaveTab('pending')">å¾…å¯©æ ¸</button>
                        <button class="tab-btn inactive" onclick="switchLeaveTab('approved')">å·²é€šé</button>
                        <button class="tab-btn inactive" onclick="switchLeaveTab('rejected')">å·²æ‹’çµ•</button>
                    </div>
                    <div id="leaveApprovalList"><p style="text-align:center;color:#666;">è¼‰å…¥ä¸­...</p></div>
                </div>

                <!-- è£œæ‰“å¡å¯©æ ¸ -->
                <div id="aprMakeup" class="aprContent" style="display:none;">
                    <div class="tabs" id="makeupApprovalTabs">
                        <button class="tab-btn active" onclick="switchMakeupTab('pending')">å¾…å¯©æ ¸</button>
                        <button class="tab-btn inactive" onclick="switchMakeupTab('approved')">å·²é€šé</button>
                        <button class="tab-btn inactive" onclick="switchMakeupTab('rejected')">å·²æ‹’çµ•</button>
                    </div>
                    <div id="makeupApprovalList"><p style="text-align:center;color:#666;">è¼‰å…¥ä¸­...</p></div>
                </div>

                <!-- åŠ ç­å¯©æ ¸ -->
                <div id="aprOvertime" class="aprContent" style="display:none;">
                    <div class="tabs" id="overtimeApprovalTabs">
                        <button class="tab-btn active" onclick="switchOtTab('pending')">å¾…å¯©æ ¸</button>
                        <button class="tab-btn inactive" onclick="switchOtTab('approved')">å·²é€šé</button>
                        <button class="tab-btn inactive" onclick="switchOtTab('rejected')">å·²æ‹’çµ•</button>
                    </div>
                    <div id="otApprovalList"><p style="text-align:center;color:#666;">è¼‰å…¥ä¸­...</p></div>
                </div>

                <!-- æ›ç­å¯©æ ¸ -->
                <div id="aprSwap" class="aprContent" style="display:none;">
                    <p style="color:#94A3B8;font-size:12px;margin-bottom:12px;">é›™æ–¹åŒæ„å¾Œæ‰æœƒå‡ºç¾åœ¨æ­¤åˆ—è¡¨</p>
                    <div id="swapApprovalList"><p style="text-align:center;color:#666;">è¼‰å…¥ä¸­...</p></div>
                </div>
            </div>
        </div>

        <!-- ====== å…¬å‘Šç®¡ç† ====== -->
        <div id="announcementPage" class="page">
            <button class="btn btn-secondary" onclick="showPage('adminHomePage')" style="width:auto;margin-bottom:10px;">â† è¿”å›</button>
            <div class="checkin-page">
                <h2>ğŸ“¢ å…¬å‘Šç®¡ç†</h2>
                <p style="color:#94A3B8;font-size:12px;margin-bottom:16px;">ç™¼å¸ƒçš„å…¬å‘Šæœƒé¡¯ç¤ºåœ¨å“¡å·¥é¦–é ä¸Šæ–¹</p>

                <!-- æ–°å¢å…¬å‘Šè¡¨å–® -->
                <div style="background:#fff;border-radius:14px;padding:16px;box-shadow:0 2px 8px rgba(0,0,0,0.06);margin-bottom:16px;">
                    <div style="font-size:14px;font-weight:800;color:#0F172A;margin-bottom:12px;">â• ç™¼å¸ƒæ–°å…¬å‘Š</div>
                    <div class="form-group">
                        <label>é¡å‹</label>
                        <select id="annType">
                            <option value="info">ğŸ“¢ ä¸€èˆ¬é€šçŸ¥</option>
                            <option value="warning">âš ï¸ æ³¨æ„äº‹é …</option>
                            <option value="urgent">ğŸš¨ ç·Šæ€¥é€šçŸ¥</option>
                            <option value="event">ğŸ‰ æ´»å‹•å…¬å‘Š</option>
                        </select>
                    </div>
                    <div class="form-group"><label>æ¨™é¡Œ</label><input type="text" id="annTitle" placeholder="ä¾‹ï¼šä¸‹é€±ä¸€åœé›»é€šçŸ¥"></div>
                    <div class="form-group"><label>å…§å®¹ (é¸å¡«)</label><textarea id="annContent" placeholder="å…¬å‘Šè©³ç´°å…§å®¹..."></textarea></div>
                    <div class="form-group">
                        <label>åˆ°æœŸæ—¥ (é¸å¡«ï¼Œç•™ç©ºæ°¸ä¹…é¡¯ç¤º)</label>
                        <input type="date" id="annExpire">
                    </div>
                    <div class="form-group" style="display:flex;flex-direction:column;gap:10px;">
                        <input type="checkbox" id="annPinned" style="display:none;">
                        <div id="annPinnedCard" onclick="toggleAnnCheck('annPinned')"
                             style="display:flex;align-items:center;gap:12px;padding:14px;background:#F8FAFC;border:2px solid #E5E7EB;border-radius:12px;cursor:pointer;transition:all 0.2s;">
                            <div id="annPinnedBox" style="width:26px;height:26px;border:2px solid #CBD5E1;border-radius:7px;display:flex;align-items:center;justify-content:center;flex-shrink:0;transition:all 0.2s;background:#fff;font-size:16px;color:#fff;"></div>
                            <span style="font-size:14px;font-weight:600;">ğŸ“Œ ç½®é ‚</span>
                        </div>
                        <input type="checkbox" id="annRequireAck" style="display:none;">
                        <div id="annRequireAckCard" onclick="toggleAnnCheck('annRequireAck')"
                             style="display:flex;align-items:center;gap:12px;padding:14px;background:#F8FAFC;border:2px solid #E5E7EB;border-radius:12px;cursor:pointer;transition:all 0.2s;">
                            <div id="annRequireAckBox" style="width:26px;height:26px;border:2px solid #CBD5E1;border-radius:7px;display:flex;align-items:center;justify-content:center;flex-shrink:0;transition:all 0.2s;background:#fff;font-size:16px;color:#fff;"></div>
                            <span style="font-size:14px;font-weight:600;">âœï¸ å¼·åˆ¶é–±è®€ç°½ç½²ï¼ˆå“¡å·¥å¿…é ˆç¢ºèªæ‰èƒ½ä½¿ç”¨ç³»çµ±ï¼‰</span>
                        </div>
                    </div>
                    <button class="btn btn-primary" onclick="publishAnnouncement()">ğŸ“¤ ç™¼å¸ƒå…¬å‘Š</button>
                </div>

                <!-- ç¾æœ‰å…¬å‘Šåˆ—è¡¨ -->
                <div style="font-size:14px;font-weight:800;color:#0F172A;margin-bottom:12px;">ğŸ“‹ ç¾æœ‰å…¬å‘Š</div>
                <div id="announcementList"><p style="text-align:center;color:#999;">è¼‰å…¥ä¸­...</p></div>
            </div>
        </div>


        <!-- ====== æ“ä½œæ—¥èªŒ ====== -->
        <!-- ä¾¿ç•¶ç®¡ç†é é¢ -->
        <div id="lunchMgrPage" class="page">
            <button class="btn btn-secondary" onclick="showPage('adminHomePage')" style="width:auto;margin-bottom:10px;">â† è¿”å›</button>
            <div class="checkin-page">
                <h2>ğŸ± ä¾¿ç•¶ç®¡ç†</h2>

                <div style="background:#fff;border-radius:14px;padding:16px;box-shadow:0 1px 3px rgba(0,0,0,0.08);margin-bottom:16px;">
                    <div style="font-size:14px;font-weight:800;color:#0F172A;margin-bottom:8px;">ğŸ‘©â€ğŸ’¼ ä¾¿ç•¶ç®¡ç†å“¡</div>
                    <p style="font-size:12px;color:#94A3B8;margin-bottom:12px;">æŒ‡å®šå¯æŸ¥çœ‹ä¾¿ç•¶è¨‚è³¼æ˜ç´°å ±è¡¨çš„å“¡å·¥ï¼ˆä¾‹å¦‚æœƒè¨ˆï¼‰ï¼Œè©²å“¡å·¥é€²å…¥ä¾¿ç•¶è¨‚è³¼é é¢æ™‚æœƒçœ‹åˆ°å®Œæ•´è¨‚è³¼æ˜ç´°å’Œ CSV åŒ¯å‡ºåŠŸèƒ½ã€‚</p>
                    <div style="display:flex;gap:8px;margin-bottom:12px;">
                        <select id="lunchMgrSelect" style="flex:1;padding:10px;border:1px solid #E5E7EB;border-radius:10px;font-size:13px;">
                            <option value="">-- é¸æ“‡å“¡å·¥ --</option>
                        </select>
                        <button onclick="addLunchManager()" style="padding:10px 16px;border:none;border-radius:10px;background:#4F46E5;color:#fff;font-weight:700;font-size:13px;cursor:pointer;white-space:nowrap;">+ æ–°å¢</button>
                    </div>
                    <div id="lunchMgrList" style="font-size:13px;color:#64748B;">è¼‰å…¥ä¸­...</div>
                </div>

                <div style="background:#fff;border-radius:14px;padding:16px;box-shadow:0 1px 3px rgba(0,0,0,0.08);margin-bottom:16px;">
                    <div style="font-size:14px;font-weight:800;color:#0F172A;margin-bottom:12px;">ğŸ“Š ä»Šæ—¥ä¾¿ç•¶çµ±è¨ˆ</div>
                    <div id="adminLunchStats" style="font-size:13px;color:#64748B;">è¼‰å…¥ä¸­...</div>
                </div>

                <div style="background:#FFF7ED;border-radius:14px;padding:14px;">
                    <div style="font-size:13px;color:#EA580C;line-height:1.6;">
                        <b>ğŸ’¡ èªªæ˜</b><br>
                        â€¢ è¢«æŒ‡å®šçš„ä¾¿ç•¶ç®¡ç†å“¡é€²å…¥ã€Œä¾¿ç•¶è¨‚è³¼ã€é é¢å¾Œï¼Œæœƒè‡ªå‹•çœ‹åˆ°è¨‚è³¼æ˜ç´°å ±è¡¨<br>
                        â€¢ å ±è¡¨åŒ…å«ï¼šçµ±è¨ˆæ•¸å­—ã€å“¡å·¥è¨‚è³¼æ˜ç´°ã€CSV åŒ¯å‡º<br>
                        â€¢ ç®¡ç†è€…ï¼ˆadminï¼‰é€²å…¥ä¾¿ç•¶é é¢ä¹Ÿæœƒè‡ªå‹•çœ‹åˆ°å ±è¡¨
                    </div>
                </div>
            </div>
        </div>

        <!-- ====== è–ªè³‡ç™¼æ”¾é é¢ ====== -->
        <div id="payrollPage" class="page">
            <button class="btn btn-secondary" onclick="showPage('adminHomePage')" style="width:auto;margin-bottom:10px;">â† è¿”å›</button>
            <div class="checkin-page">
                <h2>ğŸ’° è–ªé…¬ç®¡ç†</h2>

                <!-- ä¸‰é ç±¤ -->
                <div style="display:flex;gap:4px;margin-bottom:16px;background:#F1F5F9;border-radius:10px;padding:3px;">
                    <button class="payTab" onclick="switchPayTab('payroll',this)" style="flex:1;padding:10px;border:none;border-radius:8px;cursor:pointer;font-weight:700;font-size:13px;background:#fff;color:#4F46E5;box-shadow:0 1px 4px rgba(0,0,0,0.08);">ğŸ’° è–ªè³‡ç™¼æ”¾</button>
                    <button class="payTab" onclick="switchPayTab('bonus',this)" style="flex:1;padding:10px;border:none;border-radius:8px;cursor:pointer;font-weight:700;font-size:13px;background:transparent;color:#94A3B8;">ğŸ å¹´çµ‚çé‡‘</button>
                    <button class="payTab" onclick="switchPayTab('insurance',this)" style="flex:1;padding:10px;border:none;border-radius:8px;cursor:pointer;font-weight:700;font-size:13px;background:transparent;color:#94A3B8;">ğŸ¥ å‹å¥ä¿ç´šè·</button>
                </div>

                <!-- === è–ªè³‡ç™¼æ”¾ TAB === -->
                <div id="payTabPayroll" class="payTabContent">
                <!-- è–ªè³‡è¨­å®šå¿«æ·å…¥å£ -->
                <div style="margin-bottom:14px;">
                    <div onclick="toggleSalarySettingPanel()" style="cursor:pointer;display:flex;justify-content:space-between;align-items:center;padding:12px 16px;background:#F0FDF4;border:1px solid #BBF7D0;border-radius:12px;">
                        <span style="font-weight:700;font-size:13px;color:#059669;">ğŸ“‹ å“¡å·¥è–ªè³‡è¨­å®š</span>
                        <span id="salaryPanelArrow" style="font-size:12px;color:#059669;">â–¼</span>
                    </div>
                    <div id="salarySettingPanel" style="display:none;margin-top:8px;background:#fff;border:1px solid #E2E8F0;border-radius:12px;padding:12px;max-height:400px;overflow-y:auto;">
                        <div id="salarySettingList" style="font-size:13px;">
                            <p style="text-align:center;color:#94A3B8;">è¼‰å…¥ä¸­...</p>
                        </div>
                    </div>
                </div>

                <!-- æœˆä»½é¸æ“‡ + è¨ˆç®—æŒ‰éˆ• -->
                <div style="display:flex;gap:8px;align-items:center;margin-bottom:16px;">
                    <select id="payrollYear" style="flex:1;padding:10px;border:1px solid #E5E7EB;border-radius:10px;font-size:13px;font-weight:700;"></select>
                    <select id="payrollMonth" style="flex:1;padding:10px;border:1px solid #E5E7EB;border-radius:10px;font-size:13px;font-weight:700;"></select>
                    <button id="calcPayrollBtn" onclick="loadPayrollData()" style="padding:10px 16px;border:none;border-radius:10px;background:linear-gradient(135deg,#4F46E5,#7C3AED);color:#fff;font-weight:700;font-size:13px;cursor:pointer;white-space:nowrap;">ğŸ“Š è¨ˆç®—è–ªè³‡</button>
                </div>

                <!-- Loading -->
                <div id="payrollLoading" style="display:none;text-align:center;padding:40px;color:#94A3B8;">
                    <div style="font-size:32px;margin-bottom:8px;">â³</div>
                    <div style="font-size:14px;">æ­£åœ¨è¨ˆç®—å…¨å“¡è–ªè³‡...</div>
                </div>

                <!-- å·²ç™¼å¸ƒè­¦å‘Š -->
                <div id="payrollPublishedWarn" style="display:none;background:#FEF3C7;border:1px solid #F59E0B;border-radius:12px;padding:12px;margin-bottom:12px;font-size:13px;color:#92400E;">
                    âš ï¸ æ­¤æœˆä»½è–ªè³‡å·²ç™¼å¸ƒï¼Œé‡æ–°è¨ˆç®—å°‡è¦†è“‹ç¾æœ‰è³‡æ–™
                </div>

                <!-- æ‘˜è¦å¡ç‰‡ -->
                <div id="payrollSummary" style="display:none;background:linear-gradient(135deg,#4F46E5,#7C3AED);border-radius:16px;padding:20px;color:#fff;margin-bottom:16px;">
                    <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;">
                        <div style="text-align:center;">
                            <div style="font-size:11px;opacity:0.8;">è¨ˆç®—äººæ•¸</div>
                            <div id="prEmpCount" style="font-size:22px;font-weight:900;">0</div>
                        </div>
                        <div style="text-align:center;">
                            <div style="font-size:11px;opacity:0.8;">è–ªè³‡ç¸½é¡</div>
                            <div id="prTotalNet" style="font-size:22px;font-weight:900;">$0</div>
                        </div>
                        <div style="text-align:center;">
                            <div style="font-size:11px;opacity:0.8;">å¹³å‡å¯¦ç™¼</div>
                            <div id="prAvgNet" style="font-size:22px;font-weight:900;">$0</div>
                        </div>
                        <div style="text-align:center;">
                            <div style="font-size:11px;opacity:0.8;">ç‹€æ…‹</div>
                            <div id="prStatus" style="font-size:16px;font-weight:900;">è‰ç¨¿</div>
                        </div>
                    </div>
                </div>

                <!-- å“¡å·¥é¸æ“‡ -->
                <div id="payrollEmpSelector" style="display:none;margin-bottom:12px;">
                    <select id="payrollEmpDropdown" onchange="renderPayrollView()" style="width:100%;padding:12px;border:1px solid #E5E7EB;border-radius:12px;font-size:13px;font-weight:700;">
                        <option value="_all">ğŸ“‹ å…¨éƒ¨å“¡å·¥ç¸½è¦½</option>
                    </select>
                </div>

                <!-- å…§å®¹å€ -->
                <div id="payrollContent" style="margin-bottom:16px;"></div>

                <!-- æ“ä½œæŒ‰éˆ• -->
                <div id="payrollActions" style="display:none;flex-direction:column;gap:10px;">
                    <button id="savePayrollBtn" onclick="saveAllPayroll()" style="width:100%;padding:14px;border:none;border-radius:12px;background:linear-gradient(135deg,#059669,#10B981);color:#fff;font-weight:700;font-size:14px;cursor:pointer;">ğŸ’¾ å„²å­˜å…¨éƒ¨ï¼ˆè‰ç¨¿ï¼‰</button>
                    <button id="publishPayrollBtn" onclick="publishPayroll()" style="width:100%;padding:14px;border:none;border-radius:12px;background:linear-gradient(135deg,#DC2626,#EF4444);color:#fff;font-weight:700;font-size:14px;cursor:pointer;">ğŸ“¢ ç™¼å¸ƒè–ªè³‡ï¼ˆå“¡å·¥å¯è¦‹ï¼‰</button>
                    <button onclick="exportPayrollCSV()" style="width:100%;padding:14px;border:none;border-radius:12px;background:linear-gradient(135deg,#0EA5E9,#38BDF8);color:#fff;font-weight:700;font-size:14px;cursor:pointer;">ğŸ“¥ åŒ¯å‡º CSV</button>
                </div>
                </div>

                <!-- === å¹´çµ‚çé‡‘ TAB === -->
                <div id="payTabBonus" class="payTabContent" style="display:none;">
                <div class="form-group">
                    <label>è©¦ç®—å¹´åº¦</label>
                    <select id="bonusYear" onchange="loadHybridBonusData()"></select>
                </div>

                <div id="bonusLoading" style="text-align:center;color:#666;padding:30px;display:none;">â³ è¼‰å…¥ä¸­...</div>

                <div class="lunch-summary" id="bonusSummary" style="display:none;">
                    <h3 style="margin-bottom:15px;">ğŸ“ˆ è©¦ç®—æ‘˜è¦</h3>
                    <div class="stat-row"><span>ç¬¦åˆè³‡æ ¼äººæ•¸</span><span id="eligibleCount">0</span></div>
                    <div class="stat-row"><span>ç¸½é ç®—</span><span id="totalBudget">$0</span></div>
                    <div class="stat-row"><span>å¹³å‡çé‡‘</span><span id="avgBonus">$0</span></div>
                </div>

                <div id="matrixRef" style="display:none;">
                    <div onclick="toggleMatrixRef()" style="cursor:pointer;display:flex;justify-content:space-between;align-items:center;padding:10px 14px;background:#F5F3FF;border-radius:12px;margin-bottom:10px;">
                        <span style="font-weight:700;font-size:13px;color:#4F46E5;">ğŸ“Š çé‡‘çŸ©é™£åƒè€ƒè¡¨</span>
                        <span id="matrixRefArrow" style="font-size:12px;color:#4F46E5;">â–¼</span>
                    </div>
                    <div id="matrixRefBody" style="display:none;overflow-x:auto;margin-bottom:16px;"></div>
                </div>

                <div class="form-group" id="bonusEmpSelect" style="display:none;">
                    <label>é¸æ“‡å“¡å·¥</label>
                    <select id="bonusEmpDropdown" onchange="renderSelectedBonusCard()">
                        <option value="_all">ğŸ“‹ å…¨éƒ¨å“¡å·¥ç¸½è¦½</option>
                    </select>
                </div>

                <div id="bonusList" style="margin-top:10px;"></div>

                <div id="bonusActions" style="display:none;margin-top:20px;">
                    <button class="btn btn-success" onclick="saveAllBonuses()" id="saveAllBonusBtn">ğŸ’¾ å„²å­˜å…¨éƒ¨çé‡‘</button>
                    <button class="btn btn-secondary" onclick="exportBonusCSV()" style="margin-top:8px;">ğŸ“Š åŒ¯å‡º CSV</button>
                </div>
                </div>

                <!-- === å‹å¥ä¿ç´šè· TAB === -->
                <div id="payTabInsurance" class="payTabContent" style="display:none;">
                <div class="lunch-summary" id="insRateSummary">
                    <h3 style="margin-bottom:10px;">âš™ï¸ è²»ç‡è¨­å®š</h3>
                    <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;">
                        <div class="form-group" style="margin:0;"><label style="font-size:12px;">å‹ä¿è²»ç‡ %</label><input type="number" id="insLaborRate" step="0.01" value="12.50" style="padding:8px;font-size:13px;"></div>
                        <div class="form-group" style="margin:0;"><label style="font-size:12px;">å‹ä¿å“¡å·¥è² æ“”æ¯” %</label><input type="number" id="insLaborShare" step="0.01" value="20.00" style="padding:8px;font-size:13px;"></div>
                        <div class="form-group" style="margin:0;"><label style="font-size:12px;">å¥ä¿è²»ç‡ %</label><input type="number" id="insHealthRate" step="0.01" value="5.17" style="padding:8px;font-size:13px;"></div>
                        <div class="form-group" style="margin:0;"><label style="font-size:12px;">å¥ä¿å“¡å·¥è² æ“”æ¯” %</label><input type="number" id="insHealthShare" step="0.01" value="30.00" style="padding:8px;font-size:13px;"></div>
                    </div>
                    <button class="btn btn-primary" onclick="updateAllInsRates()" style="margin-top:10px;font-size:13px;">ğŸ“ å¥—ç”¨è²»ç‡åˆ°æ‰€æœ‰ç´šè·</button>
                </div>

                <div style="display:flex;justify-content:space-between;align-items:center;margin:16px 0 8px;">
                    <span style="font-size:14px;font-weight:700;">ğŸ“‹ ç´šè·è¡¨ï¼ˆå…± <span id="insCount">0</span> ç­†ï¼‰</span>
                    <button class="btn btn-success" onclick="showInsModal()" style="font-size:12px;padding:8px 14px;width:auto;">+ æ–°å¢</button>
                </div>

                <div style="overflow-x:auto;border-radius:12px;border:1px solid #E2E8F0;">
                    <table style="width:100%;border-collapse:collapse;font-size:12px;" id="insTable">
                        <thead>
                            <tr style="background:#F8FAFC;">
                                <th style="padding:8px 6px;text-align:right;white-space:nowrap;">è–ªè³‡ä¸‹é™</th>
                                <th style="padding:8px 6px;text-align:right;white-space:nowrap;">è–ªè³‡ä¸Šé™</th>
                                <th style="padding:8px 6px;text-align:right;white-space:nowrap;">æŠ•ä¿é‡‘é¡</th>
                                <th style="padding:8px 6px;text-align:center;">æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody id="insTableBody"></tbody>
                    </table>
                </div>
                </div>

            </div>
        </div>

        <!-- æ–°å¢/ç·¨è¼¯ç´šè· Modal (moved outside payrollPage) -->
        <div id="insModal" style="display:none;position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.5);z-index:999;overflow-y:auto;">
            <div style="background:#fff;margin:60px auto;max-width:400px;border-radius:16px;padding:24px;">
                <h3 id="insModalTitle" style="margin-bottom:16px;">æ–°å¢ç´šè·</h3>
                <input type="hidden" id="insEditId">
                <div class="form-group"><label>è–ªè³‡ä¸‹é™ *</label><input type="number" id="insSalaryMin" placeholder="0"></div>
                <div class="form-group"><label>è–ªè³‡ä¸Šé™ *</label><input type="number" id="insSalaryMax" placeholder="27470"></div>
                <div class="form-group"><label>æŠ•ä¿é‡‘é¡ *</label><input type="number" id="insAmount" placeholder="27470"></div>
                <div style="display:flex;gap:8px;">
                    <button class="btn btn-success" onclick="saveInsBracket()" style="flex:1;">ğŸ’¾ å„²å­˜</button>
                    <button class="btn btn-secondary" onclick="closeInsModal()" style="flex:1;">å–æ¶ˆ</button>
                </div>
            </div>
        </div>

        <!-- å ±è¡¨åŒ¯å‡ºé é¢ -->
        <div id="reportPage" class="page">
            <button class="btn btn-secondary" onclick="showPage('adminHomePage')" style="width:auto;margin-bottom:10px;">â† è¿”å›</button>
            <div class="checkin-page">
                <h2>ğŸ“Š å ±è¡¨åŒ¯å‡º</h2>
                <p style="color:#6b7280;font-size:13px;margin-bottom:16px;">é¸æ“‡è¦åŒ¯å‡ºçš„å ±è¡¨é¡å‹</p>
                <div class="menu-grid">
                    <button class="report-action-btn" onclick="exportReport('attendance')">
                        <div class="icon">ğŸ“ˆ</div><div class="label">å‡ºå‹¤å ±è¡¨</div>
                    </button>
                    <button class="report-action-btn" onclick="exportReport('leave')">
                        <div class="icon">ğŸ“</div><div class="label">è«‹å‡å ±è¡¨</div>
                    </button>
                    <button class="report-action-btn" onclick="exportReport('bonus')">
                        <div class="icon">ğŸ</div><div class="label">çé‡‘å ±è¡¨</div>
                    </button>
                    <button class="report-action-btn" onclick="exportReport('lunch')">
                        <div class="icon">ğŸ±</div><div class="label">ä¾¿ç•¶å ±è¡¨</div>
                    </button>
                    <button class="report-action-btn" onclick="exportReport('overtime')">
                        <div class="icon">â°</div><div class="label">åŠ ç­å ±è¡¨</div>
                    </button>
                    <button class="report-action-btn" onclick="exportReport('payroll')">
                        <div class="icon">ğŸ’°</div><div class="label">è–ªè³‡å ±è¡¨</div>
                    </button>
                    <button class="report-action-btn" onclick="showPage('fieldSalesAdminPage')">
                        <div class="icon">ğŸ“</div><div class="label">å¤–å‹¤å ±è¡¨</div>
                    </button>
                    <button class="report-action-btn" data-feature="store_ordering" onclick="exportReport('orders')">
                        <div class="icon">ğŸ½ï¸</div><div class="label">è¨‚å–®å ±è¡¨</div>
                    </button>
                </div>
            </div>
        </div>

        <!-- åŠŸèƒ½ç®¡ç†é é¢ -->
        <div id="featurePage" class="page">
            <button class="btn btn-secondary" onclick="showPage('adminHomePage')" style="width:auto;margin-bottom:10px;">â† è¿”å›</button>
            <div class="checkin-page">
                <h2>âš™ï¸ ç³»çµ±è¨­å®š</h2>

                <!-- å…©é ç±¤ -->
                <div style="display:flex;gap:4px;margin-bottom:16px;background:#F1F5F9;border-radius:10px;padding:3px;">
                    <button class="sysTab" onclick="switchSysTab('feature',this)" style="flex:1;padding:10px;border:none;border-radius:8px;cursor:pointer;font-weight:700;font-size:13px;background:#fff;color:#4F46E5;box-shadow:0 1px 4px rgba(0,0,0,0.08);">ğŸ›ï¸ åŠŸèƒ½ç®¡ç†</button>
                    <button class="sysTab" onclick="switchSysTab('audit',this)" style="flex:1;padding:10px;border:none;border-radius:8px;cursor:pointer;font-weight:700;font-size:13px;background:transparent;color:#94A3B8;">ğŸ“œ æ“ä½œæ—¥èªŒ</button>
                </div>

                <!-- === åŠŸèƒ½ç®¡ç† TAB === -->
                <div id="sysTabFeature" class="sysTabContent">
                <p style="color:#6b7280;font-size:13px;margin-bottom:16px;">æ§åˆ¶å“¡å·¥é¦–é <b>ä¸­é–“é¸å–®</b>é¡¯ç¤ºå“ªäº›åŠŸèƒ½</p>

                <div id="featureToggles" style="display:flex;flex-direction:column;gap:12px;">
                    <p id="featureLoadingHint" style="text-align:center;color:#94A3B8;font-size:13px;">è¼‰å…¥ä¸­...</p>
                </div>
                <div id="featureSaveStatus" style="margin-top:12px;text-align:center;font-size:13px;color:#059669;display:none;">âœ… å·²å„²å­˜</div>
                <p style="color:#94A3B8;font-size:12px;margin-top:16px;text-align:center;">ğŸ’¡ åº•éƒ¨å°èˆªåˆ—ï¼ˆé¦–é /ç­è¡¨/æ‰“å¡/è–ªè³‡/ç®¡ç†ï¼‰ç‚ºç®¡ç†å“¡å°ˆå±¬ï¼Œä¸å—æ­¤è¨­å®šå½±éŸ¿</p>

                <!-- LINE Notify è¨­å®š -->
                <div style="margin-top:30px;padding-top:20px;border-top:2px dashed #e5e7eb;">
                    <h3 style="margin-bottom:12px;">ğŸ”” LINE Notify æ¨æ’­è¨­å®š</h3>
                    <p style="color:#94A3B8;font-size:12px;margin-bottom:12px;">è¨­å®šå¾Œï¼Œè«‹å‡/è£œæ‰“å¡ç”³è«‹æœƒè‡ªå‹•æ¨æ’­é€šçŸ¥ç®¡ç†å“¡ç¾¤çµ„</p>
                    <div class="form-group">
                        <label>LINE Notify Token</label>
                        <input type="text" id="lineNotifyToken" placeholder="è«‹è²¼ä¸Š LINE Notify Token">
                    </div>
                    <div style="display:flex;gap:8px;">
                        <button class="btn btn-primary" onclick="saveNotifyToken()" style="flex:1;">ğŸ’¾ å„²å­˜</button>
                        <button class="btn btn-secondary" onclick="testNotify()" style="flex:1;">ğŸ”” æ¸¬è©¦æ¨æ’­</button>
                    </div>
                    <div id="notifyStatus" style="margin-top:8px;text-align:center;font-size:13px;display:none;"></div>
                    <div style="margin-top:12px;padding:10px;background:#FFF7ED;border-radius:10px;font-size:11px;color:#EA580C;line-height:1.6;">
                        ğŸ“Œ å¦‚ä½•å–å¾— Tokenï¼š<br>
                        1. å‰å¾€ <b>notify-bot.line.me</b><br>
                        2. ç™»å…¥ â†’ ç™¼è¡Œæ¬Šæ–<br>
                        3. é¸æ“‡è¦æ¥æ”¶é€šçŸ¥çš„ç¾¤çµ„<br>
                        4. è¤‡è£½ Token è²¼åˆ°ä¸Šæ–¹
                    </div>
                </div>
                </div>

                <!-- === æ“ä½œæ—¥èªŒ TAB === -->
                <div id="sysTabAudit" class="sysTabContent" style="display:none;">
                <p style="color:#94A3B8;font-size:12px;margin-bottom:12px;">ç³»çµ±è‡ªå‹•è¨˜éŒ„æ‰€æœ‰ç®¡ç†æ“ä½œ</p>
                <div id="auditLogList"><p style="text-align:center;color:#666;">è¼‰å…¥ä¸­...</p></div>
                <button class="btn btn-secondary" id="loadMoreAudit" onclick="loadAuditLogs(true)" style="margin-top:12px;">è¼‰å…¥æ›´å¤š...</button>
                </div>

            </div>
        </div>

        <!-- ====== äººåŠ›ç®¡ç†ï¼ˆæ’ç­ + ä¼‘å‡ + è¨­å®šï¼‰ ====== -->
        <div id="staffMgrPage" class="page">
            <button class="btn btn-secondary" onclick="showPage('adminHomePage')" style="width:auto;margin-bottom:10px;">â† è¿”å›</button>
            <div class="checkin-page">
                <h2>ğŸ“‹ äººåŠ›ç®¡ç†</h2>

                <!-- ä¸‰é ç±¤ -->
                <div style="display:flex;gap:4px;margin-bottom:16px;background:#F1F5F9;border-radius:10px;padding:3px;">
                    <button class="smTab" onclick="switchStaffTab('shift')" style="flex:1;padding:10px;border:none;border-radius:8px;cursor:pointer;font-weight:700;font-size:12px;background:#fff;color:#4F46E5;box-shadow:0 1px 4px rgba(0,0,0,0.08);">ğŸ“‹ æ’ç­è¡¨</button>
                    <button class="smTab" onclick="switchStaffTab('leave')" style="flex:1;padding:10px;border:none;border-radius:8px;cursor:pointer;font-weight:700;font-size:12px;background:transparent;color:#94A3B8;">ğŸ—“ï¸ ä¼‘å‡æœˆè¡¨</button>
                    <button class="smTab" onclick="switchStaffTab('setting')" style="flex:1;padding:10px;border:none;border-radius:8px;cursor:pointer;font-weight:700;font-size:12px;background:transparent;color:#94A3B8;">âš™ï¸ äººåŠ›è¨­å®š</button>
                </div>

                <!-- === æ’ç­è¡¨ TAB === -->
                <div id="tabShift" class="staffTabContent">
                    <p style="color:#6b7280;font-size:12px;margin-bottom:12px;">é»æ“Šæ ¼å­åˆ‡æ›ç­åˆ¥ï¼Œæ’å¥½å¾ŒæŒ‰å„²å­˜</p>
                    <div style="display:flex;align-items:center;justify-content:center;gap:8px;margin-bottom:12px;">
                        <button onclick="changeShiftWeek(-1)" style="background:none;border:none;font-size:20px;cursor:pointer;padding:6px 10px;border-radius:8px;">â—€</button>
                        <span id="smWeekLabel" style="font-size:14px;font-weight:700;min-width:180px;text-align:center;">-</span>
                        <button onclick="changeShiftWeek(1)" style="background:none;border:none;font-size:20px;cursor:pointer;padding:6px 10px;border-radius:8px;">â–¶</button>
                        <button onclick="resetShiftWeek()" style="padding:4px 10px;border:1px solid #E5E7EB;border-radius:6px;background:#fff;font-size:11px;font-weight:700;color:#4F46E5;cursor:pointer;">æœ¬é€±</button>
                    </div>
                    <div style="display:flex;gap:5px;margin-bottom:12px;flex-wrap:wrap;justify-content:center;">
                        <span style="font-size:10px;padding:3px 8px;background:#DBEAFE;color:#1E40AF;border-radius:6px;font-weight:700;">â˜€ï¸æ—©</span>
                        <span style="font-size:10px;padding:3px 8px;background:#FEF3C7;color:#92400E;border-radius:6px;font-weight:700;">ğŸŒ¤ï¸ä¸­</span>
                        <span style="font-size:10px;padding:3px 8px;background:#EDE9FE;color:#6D28D9;border-radius:6px;font-weight:700;">ğŸŒ™æ™š</span>
                        <span style="font-size:10px;padding:3px 8px;background:#ECFDF5;color:#059669;border-radius:6px;font-weight:700;">ğŸ–ï¸ä¼‘</span>
                        <span style="font-size:10px;padding:3px 8px;background:#F1F5F9;color:#64748B;border-radius:6px;font-weight:700;">â¬œæœªæ’</span>
                    </div>
                    <!-- äººåŠ›ä¸è¶³è­¦å‘Š -->
                    <div id="shiftStaffWarn" style="display:none;padding:10px 14px;background:#FEF2F2;border-radius:10px;margin-bottom:12px;font-size:12px;color:#DC2626;font-weight:700;"></div>
                    <div style="overflow-x:auto;-webkit-overflow-scrolling:touch;">
                        <table id="smTable" style="width:100%;border-collapse:collapse;font-size:12px;min-width:500px;"><thead id="smHead"></thead><tbody id="smBody"></tbody></table>
                    </div>
                    <!-- æ¯æ—¥äººåŠ›çµ±è¨ˆ -->
                    <div id="shiftDaySummary" style="display:flex;gap:4px;margin-top:10px;overflow-x:auto;padding-bottom:4px;"></div>
                    <div style="margin-top:14px;display:flex;gap:8px;">
                        <button onclick="saveSchedule()" style="flex:1;padding:14px;border:none;border-radius:12px;background:linear-gradient(135deg,#4F46E5,#7C3AED);color:#fff;font-weight:700;font-size:14px;cursor:pointer;">ğŸ’¾ å„²å­˜æ’ç­</button>
                        <button onclick="copyLastWeek()" style="padding:14px 20px;border:2px solid #E5E7EB;border-radius:12px;background:#fff;font-weight:700;font-size:14px;cursor:pointer;">ğŸ“‹ è¤‡è£½ä¸Šé€±</button>
                    </div>
                    <div id="smSaveStatus" style="margin-top:10px;text-align:center;font-size:13px;display:none;"></div>
                </div>

                <!-- === ä¼‘å‡æœˆè¡¨ TAB === -->
                <div id="tabLeave" class="staffTabContent" style="display:none;">
                    <p style="color:#6b7280;font-size:12px;margin-bottom:12px;">ä¸€è¦½å…¨å“¡ä¼‘å‡ç‹€æ…‹ï¼Œæ–¹ä¾¿å®‰æ’å·¥ä½œ</p>
                    <div style="display:flex;align-items:center;justify-content:center;gap:8px;margin-bottom:12px;">
                        <button onclick="changeLeaveCal(-1)" style="background:none;border:none;font-size:20px;cursor:pointer;padding:6px 10px;border-radius:8px;">â—€</button>
                        <span id="lcMonthLabel" style="font-size:14px;font-weight:700;min-width:120px;text-align:center;">-</span>
                        <button onclick="changeLeaveCal(1)" style="background:none;border:none;font-size:20px;cursor:pointer;padding:6px 10px;border-radius:8px;">â–¶</button>
                        <button onclick="resetLeaveCal()" style="padding:4px 10px;border:1px solid #E5E7EB;border-radius:6px;background:#fff;font-size:11px;font-weight:700;color:#4F46E5;cursor:pointer;">æœ¬æœˆ</button>
                    </div>
                    <div style="display:flex;gap:8px;margin-bottom:12px;">
                        <div style="flex:1;text-align:center;padding:10px;background:#EFF6FF;border-radius:12px;">
                            <div style="font-size:20px;font-weight:900;color:#2563EB;" id="lcTotal">0</div>
                            <div style="font-size:10px;font-weight:600;color:#2563EB;">ç¸½è«‹å‡äººæ¬¡</div>
                        </div>
                        <div style="flex:1;text-align:center;padding:10px;background:#ECFDF5;border-radius:12px;">
                            <div style="font-size:20px;font-weight:900;color:#059669;" id="lcAvail">0</div>
                            <div style="font-size:10px;font-weight:600;color:#059669;">ä»Šæ—¥å¯ç”¨äººåŠ›</div>
                        </div>
                        <div style="flex:1;text-align:center;padding:10px;background:#FEF2F2;border-radius:12px;">
                            <div style="font-size:20px;font-weight:900;color:#DC2626;" id="lcMax">0</div>
                            <div style="font-size:10px;font-weight:600;color:#DC2626;">ä¸Šé™</div>
                        </div>
                    </div>
                    <!-- æ—¥æœŸæœ‰è¶…éä¸Šé™çš„é«˜äº® -->
                    <div id="lcOverWarn" style="display:none;padding:10px 14px;background:#FEF2F2;border-radius:10px;margin-bottom:12px;font-size:12px;color:#DC2626;font-weight:700;"></div>
                    <div style="overflow-x:auto;-webkit-overflow-scrolling:touch;">
                        <table id="lcTable" style="width:100%;border-collapse:collapse;font-size:11px;min-width:600px;"><thead id="lcHead"></thead><tbody id="lcBody"></tbody></table>
                    </div>
                    <div style="display:flex;gap:10px;justify-content:center;margin-top:12px;flex-wrap:wrap;">
                        <span style="font-size:11px;display:flex;align-items:center;gap:4px;"><span style="width:14px;height:14px;background:#DBEAFE;border-radius:3px;display:inline-block;"></span>ç‰¹ä¼‘</span>
                        <span style="font-size:11px;display:flex;align-items:center;gap:4px;"><span style="width:14px;height:14px;background:#FEE2E2;border-radius:3px;display:inline-block;"></span>ç—…å‡</span>
                        <span style="font-size:11px;display:flex;align-items:center;gap:4px;"><span style="width:14px;height:14px;background:#FEF3C7;border-radius:3px;display:inline-block;"></span>äº‹å‡</span>
                        <span style="font-size:11px;display:flex;align-items:center;gap:4px;"><span style="width:14px;height:14px;background:#E0E7FF;border-radius:3px;display:inline-block;"></span>è£œä¼‘</span>
                        <span style="font-size:11px;display:flex;align-items:center;gap:4px;"><span style="width:14px;height:14px;background:#FCA5A5;border-radius:3px;display:inline-block;border:2px solid #DC2626;"></span>è¶…é™</span>
                    </div>
                </div>

                <!-- === äººåŠ›è¨­å®š TAB === -->
                <div id="tabSetting" class="staffTabContent" style="display:none;">
                    <p style="color:#6b7280;font-size:12px;margin-bottom:16px;">è¨­å®šè«‹å‡é™åˆ¶èˆ‡äººåŠ›è¦å‰‡</p>

                    <div style="background:#fff;border-radius:14px;padding:16px;box-shadow:0 1px 3px rgba(0,0,0,0.08);margin-bottom:16px;">
                        <div style="font-size:14px;font-weight:800;color:#0F172A;margin-bottom:12px;">ğŸš« åŒæ™‚è«‹å‡äººæ•¸ä¸Šé™</div>
                        <p style="font-size:12px;color:#94A3B8;margin-bottom:12px;">ç•¶æŸå¤©å·²æœ‰ N äººè«‹å‡ï¼Œç¬¬ N+1 äººæäº¤ç”³è«‹æ™‚æœƒè¢«<b style="color:#DC2626;">è‡ªå‹•é§å›</b></p>
                        <div style="display:flex;align-items:center;gap:12px;">
                            <button onclick="adjustMaxLeave(-1)" style="width:44px;height:44px;border:2px solid #E5E7EB;border-radius:12px;background:#fff;font-size:20px;cursor:pointer;font-weight:700;">âˆ’</button>
                            <div style="flex:1;text-align:center;">
                                <div id="maxLeaveNum" style="font-size:36px;font-weight:900;color:#4F46E5;">2</div>
                                <div style="font-size:11px;color:#94A3B8;">äºº</div>
                            </div>
                            <button onclick="adjustMaxLeave(1)" style="width:44px;height:44px;border:2px solid #E5E7EB;border-radius:12px;background:#fff;font-size:20px;cursor:pointer;font-weight:700;">+</button>
                        </div>
                        <button onclick="saveMaxLeave()" style="width:100%;margin-top:14px;padding:12px;border:none;border-radius:10px;background:linear-gradient(135deg,#4F46E5,#7C3AED);color:#fff;font-weight:700;font-size:14px;cursor:pointer;">ğŸ’¾ å„²å­˜è¨­å®š</button>
                        <div id="maxLeaveSaveStatus" style="margin-top:8px;text-align:center;font-size:13px;display:none;"></div>
                    </div>

                    <div style="background:#fff;border-radius:14px;padding:16px;box-shadow:0 1px 3px rgba(0,0,0,0.08);margin-bottom:16px;">
                        <div style="font-size:14px;font-weight:800;color:#0F172A;margin-bottom:12px;">ğŸ¢ æ’ç­æ¨¡å¼</div>
                        <p style="font-size:12px;color:#94A3B8;margin-bottom:12px;">é¸æ“‡å…¬å¸çš„ç­åˆ¥åˆ¶åº¦ï¼Œå½±éŸ¿æ’ç­è¡¨èˆ‡å“¡å·¥ç­è¡¨é é¢</p>
                        <div style="display:flex;gap:8px;margin-bottom:12px;">
                            <div id="modeShift" onclick="selectSchedulingMode('shift')" style="flex:1;padding:14px 12px;border:2px solid #4F46E5;border-radius:12px;cursor:pointer;text-align:center;background:#EEF2FF;transition:all 0.2s;">
                                <div style="font-size:24px;margin-bottom:6px;">ğŸ”„</div>
                                <div id="modeShiftLabel" style="font-size:13px;font-weight:800;color:#4F46E5;">æ’ç­åˆ¶</div>
                                <div style="font-size:10px;color:#94A3B8;margin-top:4px;">æœå‹™æ¥­ã€é¤é£²ã€é›¶å”®<br>æ—©/ä¸­/æ™šè¼ªç­</div>
                            </div>
                            <div id="modeFixed" onclick="selectSchedulingMode('fixed')" style="flex:1;padding:14px 12px;border:2px solid #E5E7EB;border-radius:12px;cursor:pointer;text-align:center;background:#fff;transition:all 0.2s;">
                                <div style="font-size:24px;margin-bottom:6px;">â˜€ï¸</div>
                                <div id="modeFixedLabel" style="font-size:13px;font-weight:800;color:#94A3B8;">å›ºå®šç­</div>
                                <div style="font-size:10px;color:#94A3B8;margin-top:4px;">å›ºå®šæ™‚æ®µä¸Šç­<br>å¯è‡ªè¨‚æ™‚é–“</div>
                            </div>
                        </div>
                        <!-- å›ºå®šç­è¨­å®šï¼ˆé¸æ“‡å›ºå®šç­æ™‚é¡¯ç¤ºï¼‰ -->
                        <div id="fixedShiftConfig" style="display:none;margin-bottom:12px;">
                            <div style="font-size:12px;font-weight:700;color:#4b5563;margin-bottom:8px;">å›ºå®šç­åˆ¥è¨­å®š</div>
                            <div style="display:flex;gap:6px;margin-bottom:10px;">
                                <button onclick="setFixedPreset('08:00','17:00')" class="fixedPresetBtn" style="flex:1;padding:8px;border:1px solid #E5E7EB;border-radius:8px;background:#fff;font-size:11px;font-weight:700;cursor:pointer;color:#4F46E5;">â˜€ï¸ æ—©ç­</button>
                                <button onclick="setFixedPreset('13:00','22:00')" class="fixedPresetBtn" style="flex:1;padding:8px;border:1px solid #E5E7EB;border-radius:8px;background:#fff;font-size:11px;font-weight:700;cursor:pointer;color:#F59E0B;">ğŸŒ¤ï¸ ä¸­ç­</button>
                                <button onclick="setFixedPreset('22:00','07:00')" class="fixedPresetBtn" style="flex:1;padding:8px;border:1px solid #E5E7EB;border-radius:8px;background:#fff;font-size:11px;font-weight:700;cursor:pointer;color:#8B5CF6;">ğŸŒ™ æ™šç­</button>
                            </div>
                            <div style="display:flex;gap:8px;align-items:center;">
                                <div style="flex:1;">
                                    <label style="font-size:11px;color:#94A3B8;display:block;margin-bottom:4px;">ä¸Šç­æ™‚é–“</label>
                                    <input type="time" id="fixedStartTime" value="08:00" style="width:100%;padding:10px;border:1px solid #E5E7EB;border-radius:8px;font-size:14px;font-weight:700;">
                                </div>
                                <span style="margin-top:16px;font-weight:700;color:#94A3B8;">~</span>
                                <div style="flex:1;">
                                    <label style="font-size:11px;color:#94A3B8;display:block;margin-bottom:4px;">ä¸‹ç­æ™‚é–“</label>
                                    <input type="time" id="fixedEndTime" value="17:00" style="width:100%;padding:10px;border:1px solid #E5E7EB;border-radius:8px;font-size:14px;font-weight:700;">
                                </div>
                            </div>
                        </div>
                        <button onclick="saveSchedulingMode()" style="width:100%;padding:12px;border:none;border-radius:10px;background:linear-gradient(135deg,#4F46E5,#7C3AED);color:#fff;font-weight:700;font-size:14px;cursor:pointer;">ğŸ’¾ å„²å­˜æ’ç­æ¨¡å¼</button>
                        <div id="schedModeSaveStatus" style="margin-top:8px;text-align:center;font-size:13px;display:none;"></div>
                    </div>

                    <div style="background:#fff;border-radius:14px;padding:16px;box-shadow:0 1px 3px rgba(0,0,0,0.08);margin-top:16px;">
                        <div style="font-size:14px;font-weight:800;color:#0F172A;margin-bottom:12px;">ğŸ“Š ç›®å‰äººåŠ›æ¦‚æ³</div>
                        <div id="staffOverview" style="font-size:13px;color:#64748B;line-height:1.8;">è¼‰å…¥ä¸­...</div>
                    </div>

                    <div style="background:#FFF7ED;border-radius:14px;padding:14px;margin-top:16px;">
                        <div style="font-size:13px;color:#EA580C;line-height:1.6;">
                            <b>ğŸ’¡ è‡ªå‹•é§å›è¦å‰‡èªªæ˜</b><br>
                            â€¢ å“¡å·¥å¡«å…¥è«‹å‡æ—¥æœŸæ™‚ï¼Œç³»çµ±<b>å³æ™‚æª¢æŸ¥</b>è©²æ—¥å·²æœ‰å¹¾äººè«‹å‡<br>
                            â€¢ è‹¥åŠ ä¸Šç”³è«‹è€…æœƒè¶…éä¸Šé™ï¼Œ<b>è¡¨å–®ç›´æ¥é–å®š</b>ç„¡æ³•æäº¤<br>
                            â€¢ å·²æ ¸å‡† + å¾…å¯©æ ¸ çš„å‡éƒ½æœƒè¢«è¨ˆå…¥<br>
                            â€¢ é€±æœ«ä¸è¨ˆå…¥è¡çªæª¢æŸ¥
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- å®¢æˆ¶ç®¡ç†é é¢ -->
        <div id="clientPage" class="page">
            <button class="btn btn-secondary" onclick="showPage('adminHomePage')" style="width:auto;margin-bottom:10px;">â† è¿”å›</button>
            <div class="checkin-page">
                <h2>ğŸ¢ å®¢æˆ¶ç®¡ç†</h2>

                <div style="display:flex;gap:8px;margin-bottom:12px;">
                    <input type="text" id="clientSearch" placeholder="æœå°‹å…¬å¸åç¨±..." oninput="filterClients()" style="flex:1;padding:10px;border:1px solid #E2E8F0;border-radius:10px;font-size:14px;">
                    <button class="btn btn-primary" onclick="showClientModal()" style="white-space:nowrap;font-size:13px;padding:10px 16px;">+ æ–°å¢</button>
                </div>

                <div id="clientList">
                    <p style="text-align:center;color:#94A3B8;font-size:13px;padding:16px;">è¼‰å…¥ä¸­...</p>
                </div>

                <!-- æœå‹™é …ç›®ç®¡ç† -->
                <div class="lunch-summary" style="margin-top:20px;">
                    <h3 style="margin-bottom:10px;">ğŸ”§ æœå‹™é …ç›®ç®¡ç†</h3>
                    <div id="serviceItemList"></div>
                    <div style="display:flex;gap:8px;margin-top:10px;">
                        <input type="text" id="newServiceItemName" placeholder="æ–°å¢æœå‹™é …ç›®åç¨±" style="flex:1;padding:10px;border:1px solid #E2E8F0;border-radius:10px;font-size:13px;">
                        <button class="btn btn-success" onclick="addServiceItem()" style="font-size:12px;padding:8px 14px;white-space:nowrap;">æ–°å¢</button>
                    </div>
                </div>
            </div>

            <!-- å®¢æˆ¶æ–°å¢/ç·¨è¼¯ Modal -->
            <div id="clientModal" style="display:none;position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.5);z-index:999;overflow-y:auto;">
                <div style="background:#fff;margin:40px auto;max-width:500px;border-radius:16px;padding:24px;">
                    <h3 id="clientModalTitle" style="margin-bottom:16px;">æ–°å¢å®¢æˆ¶</h3>
                    <input type="hidden" id="clientEditId">
                    <div class="form-group"><label>å…¬å¸åç¨± *</label><input type="text" id="clientCompanyName" placeholder="å…¬å¸åç¨±"></div>
                    <div class="form-group"><label>è¯çµ¡äºº</label><input type="text" id="clientContactName" placeholder="è¯çµ¡äººå§“å"></div>
                    <div class="form-group"><label>é›»è©±</label><input type="text" id="clientPhone" placeholder="é›»è©±"></div>
                    <div class="form-group"><label>åœ°å€</label><input type="text" id="clientAddress" placeholder="åœ°å€"></div>
                    <div class="form-group">
                        <label>GPS åº§æ¨™</label>
                        <div style="display:flex;gap:8px;">
                            <input type="text" id="clientLat" placeholder="ç·¯åº¦" style="flex:1;">
                            <input type="text" id="clientLng" placeholder="ç¶“åº¦" style="flex:1;">
                        </div>
                        <button class="btn btn-secondary" onclick="getClientGPS()" style="margin-top:6px;font-size:12px;padding:8px;">ğŸ“ æŠ“å–ç›®å‰ä½ç½®</button>
                    </div>
                    <div class="form-group">
                        <label>åˆ†é¡</label>
                        <select id="clientCategory" style="width:100%;padding:10px;border:1px solid #E2E8F0;border-radius:10px;font-size:14px;">
                            <option value="general">ä¸€èˆ¬</option>
                            <option value="vip">VIP â­</option>
                        </select>
                    </div>
                    <div class="form-group"><label>ç”¢æ¥­åˆ¥</label><input type="text" id="clientIndustry" placeholder="ä¾‹ï¼šç§‘æŠ€æ¥­ã€è£½é€ æ¥­"></div>
                    <div class="form-group"><label>å‚™è¨»</label><textarea id="clientNotes" rows="2" placeholder="å‚™è¨»" style="width:100%;padding:10px;border:1px solid #E2E8F0;border-radius:10px;font-size:14px;resize:vertical;box-sizing:border-box;"></textarea></div>
                    <div style="display:flex;gap:8px;">
                        <button class="btn btn-success" onclick="saveClient()" style="flex:1;">ğŸ’¾ å„²å­˜</button>
                        <button class="btn btn-secondary" onclick="closeClientModal()" style="flex:1;">å–æ¶ˆ</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ====== å¤–å‹¤/æ¥­å‹™ åˆä½µç®¡ç†é  ====== -->
        <div id="fieldSalesAdminPage" class="page">
            <button class="btn btn-secondary" onclick="showPage('adminHomePage')" style="width:auto;margin-bottom:10px;">â† è¿”å›</button>
            <div class="checkin-page">
                <h2>ğŸ“ å¤–å‹¤/æ¥­å‹™</h2>
                <!-- Tab åˆ‡æ› -->
                <div style="display:flex;gap:4px;margin-bottom:16px;background:#F1F5F9;border-radius:10px;padding:3px;">
                    <button class="fsaTab" onclick="switchFieldSalesAdmin('approval',this)" style="flex:1;padding:10px;border:none;border-radius:8px;cursor:pointer;font-weight:700;font-size:13px;background:#fff;color:#4F46E5;box-shadow:0 1px 4px rgba(0,0,0,0.08);">ğŸ“‹ å¤–å‹¤å¯©æ ¸</button>
                    <button class="fsaTab" onclick="switchFieldSalesAdmin('target',this)" style="flex:1;padding:10px;border:none;border-radius:8px;cursor:pointer;font-weight:700;font-size:13px;background:transparent;color:#94A3B8;">ğŸ¯ æ¥­å‹™ç›®æ¨™</button>
                </div>

                <!-- å¤–å‹¤å¯©æ ¸ Tab -->
                <div id="fsaApprovalTab">
                    <!-- ç¯©é¸ -->
                    <div style="display:flex;gap:8px;flex-wrap:wrap;margin-bottom:12px;">
                        <input type="date" id="fwaDateFrom" style="flex:1;min-width:120px;padding:8px;border:1px solid #E2E8F0;border-radius:8px;font-size:13px;">
                        <input type="date" id="fwaDateTo" style="flex:1;min-width:120px;padding:8px;border:1px solid #E2E8F0;border-radius:8px;font-size:13px;">
                        <select id="fwaStatusFilter" style="padding:8px;border:1px solid #E2E8F0;border-radius:8px;font-size:13px;">
                            <option value="submitted">å¾…å¯©æ ¸</option>
                            <option value="approved">å·²æ ¸å‡†</option>
                            <option value="rejected">å·²é€€å›</option>
                            <option value="">å…¨éƒ¨</option>
                        </select>
                        <button class="btn btn-primary" onclick="loadFieldWorkApprovals()" style="font-size:12px;padding:8px 14px;">æŸ¥è©¢</button>
                    </div>

                    <!-- çµ±è¨ˆ -->
                    <div style="display:flex;gap:8px;margin-bottom:12px;">
                        <div style="flex:1;text-align:center;padding:8px;background:#DBEAFE;border-radius:8px;">
                            <div style="font-size:18px;font-weight:900;color:#1E40AF;" id="fwaTotal">0</div>
                            <div style="font-size:10px;color:#1E40AF;">ç¸½ç­†æ•¸</div>
                        </div>
                        <div style="flex:1;text-align:center;padding:8px;background:#FEF3C7;border-radius:8px;">
                            <div style="font-size:18px;font-weight:900;color:#92400E;" id="fwaPending">0</div>
                            <div style="font-size:10px;color:#92400E;">å¾…å¯©æ ¸</div>
                        </div>
                        <div style="flex:1;text-align:center;padding:8px;background:#D1FAE5;border-radius:8px;">
                            <div style="font-size:18px;font-weight:900;color:#059669;" id="fwaTotalHours">0</div>
                            <div style="font-size:10px;color:#059669;">ç¸½å·¥æ™‚(h)</div>
                        </div>
                    </div>

                    <div id="fwaList">
                        <p style="text-align:center;color:#94A3B8;font-size:13px;padding:16px;">è«‹é¸æ“‡æ—¥æœŸæŸ¥è©¢</p>
                    </div>

                    <button class="btn btn-secondary" onclick="exportFieldWorkCSV()" style="width:100%;margin-top:12px;font-size:13px;padding:12px;">ğŸ“¥ åŒ¯å‡ºå¤–å‹¤ CSV</button>
                </div>

                <!-- æ¥­å‹™ç›®æ¨™ Tab -->
                <div id="fsaTargetTab" style="display:none;">
                    <!-- é€±åˆ‡æ› -->
                    <div style="display:flex;align-items:center;justify-content:center;gap:12px;margin-bottom:16px;">
                        <button onclick="stChangeWeek(-1)" style="padding:8px 14px;border:1px solid #E2E8F0;border-radius:10px;background:#fff;cursor:pointer;font-size:16px;">â†</button>
                        <span id="stWeekLabel" style="font-weight:700;font-size:14px;min-width:180px;text-align:center;"></span>
                        <button onclick="stChangeWeek(1)" style="padding:8px 14px;border:1px solid #E2E8F0;border-radius:10px;background:#fff;cursor:pointer;font-size:16px;">â†’</button>
                    </div>

                    <!-- è¨­å®šç›®æ¨™å€ -->
                    <div style="background:#fff;border-radius:14px;padding:16px;box-shadow:0 2px 8px rgba(0,0,0,0.06);margin-bottom:16px;">
                        <div style="font-size:14px;font-weight:800;color:#0F172A;margin-bottom:12px;">ğŸ¯ æœ¬é€±å…¨å“¡é è¨­ç›®æ¨™</div>
                        <div style="display:flex;gap:12px;margin-bottom:12px;">
                            <div style="flex:1;">
                                <label style="font-size:12px;font-weight:600;color:#64748B;display:block;margin-bottom:4px;">ğŸ“ é›»è©±æ‹œè¨ª</label>
                                <input type="number" id="stDefaultCall" min="0" value="0" style="width:100%;padding:10px;border:1px solid #E2E8F0;border-radius:10px;font-size:14px;box-sizing:border-box;">
                            </div>
                            <div style="flex:1;">
                                <label style="font-size:12px;font-weight:600;color:#64748B;display:block;margin-bottom:4px;">ğŸ¢ å¯¦åœ°æ‹œè¨ª</label>
                                <input type="number" id="stDefaultVisit" min="0" value="0" style="width:100%;padding:10px;border:1px solid #E2E8F0;border-radius:10px;font-size:14px;box-sizing:border-box;">
                            </div>
                        </div>
                        <button class="btn btn-primary" onclick="saveDefaultTarget()" style="font-size:13px;padding:10px;">ğŸ’¾ å„²å­˜é è¨­ç›®æ¨™</button>
                    </div>

                    <!-- å…¨å“¡é€²åº¦ç¸½è¦½ -->
                    <div style="font-size:14px;font-weight:800;color:#0F172A;margin-bottom:12px;">ğŸ“Š å…¨å“¡é€²åº¦ç¸½è¦½</div>
                    <div id="stProgressList"><p style="text-align:center;color:#999;">è¼‰å…¥ä¸­...</p></div>
                </div>
            </div>

            <!-- æ˜ç´° Modal -->
            <div id="fwaDetailModal" style="display:none;position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.5);z-index:999;overflow-y:auto;">
                <div style="background:#fff;margin:30px auto;max-width:500px;border-radius:16px;padding:24px;">
                    <div id="fwaDetailContent"></div>
                    <div id="fwaDetailActions" style="display:flex;gap:8px;margin-top:16px;"></div>
                    <button class="btn btn-secondary" onclick="closeFwaDetailModal()" style="width:100%;margin-top:8px;font-size:13px;">é—œé–‰</button>
                </div>
            </div>
        </div>

        <!-- ====== é¤é£²æ¥­ç®¡ç† ====== -->
        <div id="restaurantPage" class="page">
            <button class="btn btn-secondary" onclick="showPage('adminHomePage')" style="width:auto;margin-bottom:10px;">â† è¿”å›</button>
            <div class="checkin-page">
                <h2>ğŸ½ï¸ é¤é£²æ¥­ç®¡ç†</h2>
                <button class="btn btn-primary" onclick="showStoreModal()" style="margin-bottom:16px;font-size:13px;padding:12px;">+ æ–°å¢å•†åº—</button>
                <div id="restaurantStoreList"><p style="text-align:center;color:#999;">è¼‰å…¥ä¸­...</p></div>
            </div>
        </div>

        <!-- å•†åº—è©³æƒ…é  -->
        <div id="restaurantDetailPage" class="page">
            <button class="btn btn-secondary" onclick="showPage('adminHomePage')" style="width:auto;margin-bottom:10px;">â† è¿”å›</button>
            <div class="checkin-page">
                <!-- åº—é ­è³‡è¨Š -->
                <div id="rdStoreHeader" style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;">
                    <h2 id="rdStoreName" style="margin:0;font-size:18px;"></h2>
                    <div style="display:flex;gap:6px;">
                        <button onclick="previewStoreOrder()" style="padding:6px 10px;border:none;border-radius:8px;background:#4F46E5;color:#fff;font-size:12px;cursor:pointer;">ğŸ‘ï¸ é è¦½</button>
                        <button onclick="openKDS()" style="padding:6px 10px;border:none;border-radius:8px;background:#1E293B;color:#fff;font-size:12px;cursor:pointer;">ğŸ³ KDS</button>
                        <button onclick="showStoreQR(rdCurrentStoreId)" style="padding:6px 10px;border:1px solid #E2E8F0;border-radius:8px;background:#fff;font-size:12px;cursor:pointer;">ğŸ“± QR</button>
                        <button onclick="editStore(rdCurrentStoreId)" style="padding:6px 10px;border:1px solid #E2E8F0;border-radius:8px;background:#fff;font-size:12px;cursor:pointer;">ğŸ“ ç·¨è¼¯</button>
                    </div>
                </div>
                <div id="rdStorePreviewLink" style="margin-bottom:8px;"></div>
                <div id="rdAcceptOrderToggle" style="margin-bottom:12px;"></div>

                <!-- Tab åˆ‡æ› -->
                <div style="display:flex;gap:0;margin-bottom:14px;border-bottom:2px solid #E2E8F0;">
                    <div class="rdTab rdTabActive" onclick="switchRestaurantTab('orders',this)" style="flex:1;text-align:center;padding:10px 0;font-size:13px;font-weight:700;cursor:pointer;border-bottom:3px solid #4F46E5;margin-bottom:-2px;color:#4F46E5;">ğŸ“‹ è¨‚å–®</div>
                    <div class="rdTab" onclick="switchRestaurantTab('menu',this)" style="flex:1;text-align:center;padding:10px 0;font-size:13px;font-weight:600;cursor:pointer;color:#94A3B8;">ğŸ½ï¸ èœå–®</div>
                    <div class="rdTab" onclick="switchRestaurantTab('report',this)" style="flex:1;text-align:center;padding:10px 0;font-size:13px;font-weight:600;cursor:pointer;color:#94A3B8;">ğŸ“Š å ±è¡¨</div>
                    <div class="rdTab" onclick="switchRestaurantTab('settings',this)" style="flex:1;text-align:center;padding:10px 0;font-size:13px;font-weight:600;cursor:pointer;color:#94A3B8;">âš™ï¸ è¨­å®š</div>
                </div>

                <!-- è¨‚å–® Tab -->
                <div id="rdOrdersTab">
                    <div style="display:flex;gap:8px;flex-wrap:wrap;margin-bottom:10px;">
                        <select id="rdStatusFilter" style="flex:1;padding:8px;border:1px solid #E2E8F0;border-radius:8px;font-size:13px;">
                            <option value="">å…¨éƒ¨ç‹€æ…‹</option>
                            <option value="pending" selected>å¾…è™•ç†</option>
                            <option value="confirmed">å·²ç¢ºèª</option>
                            <option value="preparing">æº–å‚™ä¸­</option>
                            <option value="ready">å¯å–é¤</option>
                            <option value="completed">å·²å®Œæˆ</option>
                            <option value="cancelled">å·²å–æ¶ˆ</option>
                        </select>
                        <button class="btn btn-primary" onclick="loadStoreOrders()" style="font-size:12px;padding:8px 14px;">æŸ¥è©¢</button>
                        <button id="soundToggleBtn" onclick="toggleOrderSound()" style="font-size:16px;padding:6px 10px;border:1px solid #E2E8F0;border-radius:8px;background:#fff;cursor:pointer;" title="è¨‚å–®éŸ³æ•ˆ">ğŸ””</button>
                    </div>
                    <!-- çµ±è¨ˆ -->
                    <div style="display:flex;gap:8px;margin-bottom:12px;">
                        <div style="flex:1;text-align:center;padding:8px;background:#FEF3C7;border-radius:8px;">
                            <div style="font-size:18px;font-weight:900;color:#92400E;" id="rdPendingCount">0</div>
                            <div style="font-size:10px;color:#92400E;">å¾…è™•ç†</div>
                        </div>
                        <div style="flex:1;text-align:center;padding:8px;background:#DBEAFE;border-radius:8px;">
                            <div style="font-size:18px;font-weight:900;color:#1E40AF;" id="rdTodayCount">0</div>
                            <div style="font-size:10px;color:#1E40AF;">ä»Šæ—¥è¨‚å–®</div>
                        </div>
                        <div style="flex:1;text-align:center;padding:8px;background:#D1FAE5;border-radius:8px;">
                            <div style="font-size:18px;font-weight:900;color:#059669;" id="rdTodayRevenue">$0</div>
                            <div style="font-size:10px;color:#059669;">ä»Šæ—¥ç‡Ÿæ”¶</div>
                        </div>
                    </div>
                    <!-- ç†±éŠ· TOP 5 -->
                    <div id="rdTopSelling" style="display:none;background:#FFFBEB;border-radius:10px;padding:10px 14px;margin-bottom:12px;font-size:12px;"></div>
                    <div id="rdOrderList"><p style="text-align:center;color:#999;">è¼‰å…¥ä¸­...</p></div>
                </div>

                <!-- èœå–® Tab -->
                <div id="rdMenuTab" style="display:none;">
                    <!-- åˆ†é¡ç®¡ç† -->
                    <div style="background:#F8FAFC;border-radius:12px;padding:14px;margin-bottom:16px;">
                        <div style="font-weight:700;font-size:14px;margin-bottom:8px;">ğŸ“‚ åˆ†å¤§é¡</div>
                        <div id="menuCatList" style="margin-bottom:8px;"></div>
                        <div style="display:flex;gap:8px;">
                            <input type="text" id="newCatName" placeholder="æ–°åˆ†å¤§é¡åç¨±" style="flex:1;padding:8px;border:1px solid #E2E8F0;border-radius:8px;font-size:13px;box-sizing:border-box;">
                            <button onclick="addMenuCategory()" style="padding:8px 14px;border:none;border-radius:8px;background:#4F46E5;color:#fff;font-weight:600;font-size:13px;cursor:pointer;">+ æ–°å¢</button>
                        </div>
                    </div>
                    <!-- AI èœå–®è¾¨è­˜ -->
                    <div style="background:linear-gradient(135deg,#EEF2FF,#FDF4FF);border:1px solid #C7D2FE;border-radius:12px;padding:14px;margin-bottom:16px;">
                        <div style="font-weight:700;font-size:14px;margin-bottom:6px;">ğŸ“¸ ä¸Šå‚³èœå–®åœ–ç‰‡ï¼ˆAI è‡ªå‹•å»ºç«‹ï¼‰</div>
                        <p style="font-size:11px;color:#64748B;margin-bottom:10px;">æ‹ç…§æˆ–ä¸Šå‚³ç¾æœ‰èœå–®ï¼ŒAI è‡ªå‹•è¾¨è­˜å“åã€åƒ¹æ ¼ã€åˆ†é¡ï¼Œä¸€éµåŒ¯å…¥</p>
                        <input type="file" id="menuPhotoInput" accept="image/*" style="display:none;" onchange="handleMenuPhotoUpload(this)">
                        <button onclick="document.getElementById('menuPhotoInput').click()" style="width:100%;padding:12px;border:2px dashed #8B5CF6;border-radius:12px;background:#F5F3FF;color:#7C3AED;font-weight:700;font-size:13px;cursor:pointer;">ğŸ“· é¸æ“‡èœå–®åœ–ç‰‡</button>
                        <div id="menuPhotoPreview" style="display:none;margin-top:10px;">
                            <img id="menuPhotoImg" style="width:100%;border-radius:8px;margin-bottom:8px;">
                            <button onclick="analyzeMenuPhoto()" id="menuPhotoAnalyzeBtn" style="width:100%;padding:12px;border:none;border-radius:10px;background:linear-gradient(135deg,#7C3AED,#4F46E5);color:#fff;font-weight:700;font-size:13px;cursor:pointer;">ğŸ¤– AI è¾¨è­˜èœå–®</button>
                            <div id="menuPhotoStatus" style="font-size:12px;color:#64748B;text-align:center;margin-top:6px;"></div>
                        </div>
                        <!-- AI è¾¨è­˜çµæœé è¦½ -->
                        <div id="menuAIResult" style="display:none;margin-top:12px;">
                            <div style="font-weight:700;font-size:13px;margin-bottom:8px;">âœ… è¾¨è­˜çµæœé è¦½</div>
                            <div id="menuAICategories" style="margin-bottom:8px;"></div>
                            <div id="menuAIItems" style="max-height:300px;overflow-y:auto;border:1px solid #E2E8F0;border-radius:8px;"></div>
                            <div style="display:flex;gap:8px;margin-top:10px;">
                                <button onclick="confirmAIMenu()" style="flex:1;padding:10px;border:none;border-radius:10px;background:#059669;color:#fff;font-weight:700;font-size:13px;cursor:pointer;">âœ… ç¢ºèªåŒ¯å…¥</button>
                                <button onclick="cancelAIMenu()" style="padding:10px 16px;border:1px solid #E2E8F0;border-radius:10px;background:#fff;color:#64748B;font-weight:600;font-size:13px;cursor:pointer;">å–æ¶ˆ</button>
                            </div>
                        </div>
                    </div>
                    <!-- å“é …ç®¡ç† -->
                    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;">
                        <div>
                            <span style="font-weight:700;font-size:14px;">ğŸ½ï¸ å“é …</span>
                            <span id="menuItemCount" style="font-size:12px;color:#94A3B8;margin-left:6px;"></span>
                        </div>
                        <button onclick="showCopyMenuModal()" style="padding:6px 12px;border:1px solid #E2E8F0;border-radius:8px;background:#fff;font-size:11px;cursor:pointer;">ğŸ“‹ è¤‡è£½èœå–®åˆ°å…¶ä»–å•†åº—</button>
                    </div>
                    <button onclick="showMenuItemForm()" style="width:100%;padding:12px;border:2px dashed #4F46E5;border-radius:14px;background:#EEF2FF;color:#4F46E5;font-weight:800;font-size:14px;cursor:pointer;margin-bottom:12px;">+ æ–°å¢å“é …</button>
                    <div id="menuItemList"></div>

                    <!-- å…¨è¢å¹•æŠ½å±œï¼šæ–°å¢/ç·¨è¼¯å“é … -->
                    <div id="miDrawerMask" class="mi-drawer-mask" style="display:none;" onclick="cancelMenuItemForm()"></div>
                    <div id="miDrawer" class="mi-drawer" style="display:none;">
                        <input type="hidden" id="miEditId">
                        <input type="hidden" id="miImageUrl">
                        <input type="file" id="miImageFile" accept="image/*" onchange="handleMenuImageUpload(this)" style="display:none;">
                        <!-- é ‚éƒ¨æ¬„ -->
                        <div class="mi-drawer-header">
                            <button onclick="cancelMenuItemForm()" style="border:none;background:none;font-size:14px;font-weight:700;color:#64748B;cursor:pointer;padding:6px 0;">âœ• å–æ¶ˆ</button>
                            <span id="miDrawerTitle" style="font-size:15px;font-weight:900;color:#0F172A;">æ–°å¢å“é …</span>
                            <button onclick="toggleMiPreview()" id="miPreviewBtn" style="border:1.5px solid #E2E8F0;background:#fff;color:#64748B;border-radius:8px;font-size:11px;font-weight:700;padding:6px 10px;cursor:pointer;">ğŸ‘ é è¦½</button>
                        </div>
                        <!-- å¯æ²å‹•å…§å®¹ -->
                        <div class="mi-drawer-body">
                            <!-- é è¦½é¢æ¿ -->
                            <div id="miPreviewPanel" style="display:none;"></div>
                            <!-- è¡¨å–®é¢æ¿ -->
                            <div id="miFormPanel">
                                <!-- Section 1: åŸºæœ¬è³‡è¨Š -->
                                <div class="mi-section">
                                    <div class="mi-section-hd" onclick="toggleMiSection(this)">
                                        <div class="title"><span>ğŸ“</span> åŸºæœ¬è³‡è¨Š</div>
                                        <span class="arrow open">â–¼</span>
                                    </div>
                                    <div class="mi-section-bd">
                                        <div class="mi-field">
                                            <label>å“å <span class="req">*</span></label>
                                            <input type="text" id="miName" class="mi-input" placeholder="ä¾‹ï¼šæ‹›ç‰Œç‰›è‚‰éºµ">
                                        </div>
                                        <div style="display:flex;gap:10px;">
                                            <div class="mi-field" style="flex:1;">
                                                <label>åˆ†å¤§é¡</label>
                                                <select id="miCategory" class="mi-select"></select>
                                            </div>
                                            <div class="mi-field" style="flex:1;">
                                                <label>åƒ¹æ ¼ <span class="req">*</span></label>
                                                <div style="position:relative;">
                                                    <span style="position:absolute;left:12px;top:50%;transform:translateY(-50%);font-size:14px;font-weight:800;color:#94A3B8;">$</span>
                                                    <input type="number" id="miPrice" class="mi-input" min="0" placeholder="0" style="padding-left:28px;">
                                                </div>
                                            </div>
                                        </div>
                                        <div class="mi-field">
                                            <label>èªªæ˜</label>
                                            <input type="text" id="miDesc" class="mi-input" placeholder="ç°¡çŸ­æè¿°å“é …ç‰¹è‰²">
                                            <div class="hint">é¸å¡«ï¼Œæœƒé¡¯ç¤ºåœ¨å®¢äººé»é¤é é¢</div>
                                        </div>
                                    </div>
                                </div>
                                <!-- Section 2: å“é …åœ–ç‰‡ -->
                                <div class="mi-section">
                                    <div class="mi-section-hd" onclick="toggleMiSection(this)">
                                        <div class="title"><span>ğŸ“·</span> å“é …åœ–ç‰‡</div>
                                        <span class="arrow">â–¼</span>
                                    </div>
                                    <div class="mi-section-bd" style="display:none;">
                                        <div id="miImageArea" onclick="document.getElementById('miImageFile').click()" style="border:2px dashed #CBD5E1;border-radius:14px;padding:20px;text-align:center;cursor:pointer;background:#F8FAFC;">
                                            <img id="miImagePreview" style="width:100px;height:100px;border-radius:12px;object-fit:cover;display:none;border:1px solid #E2E8F0;margin:0 auto 8px;">
                                            <div id="miImagePlaceholder">
                                                <div style="font-size:32px;margin-bottom:4px;">ğŸ“·</div>
                                                <div style="font-size:12px;font-weight:700;color:#64748B;">é»æ“Šä¸Šå‚³å“é …åœ–ç‰‡</div>
                                                <div style="font-size:11px;color:#94A3B8;margin-top:2px;">å»ºè­° 400Ã—400ï¼ŒJPG/PNG</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!-- Section 3: å®¢è£½åŒ–é¸é … -->
                                <div class="mi-section">
                                    <div class="mi-section-hd" onclick="toggleMiSection(this)">
                                        <div class="title"><span>ğŸ›</span> å®¢è£½åŒ–é¸é … <span id="miOptBadge" class="mi-badge mi-badge-opt" style="display:none;"></span></div>
                                        <span class="arrow">â–¼</span>
                                    </div>
                                    <div class="mi-section-bd" id="miOptionsSection" style="display:none;">
                                        <div id="miOptionsEditor"></div>
                                    </div>
                                </div>
                                <!-- Section 4: å¥—é¤çµ„åˆ -->
                                <div class="mi-section">
                                    <div class="mi-section-hd" onclick="toggleMiSection(this)">
                                        <div class="title"><span>ğŸ±</span> å¥—é¤çµ„åˆ</div>
                                        <span class="arrow">â–¼</span>
                                    </div>
                                    <div class="mi-section-bd" id="miComboSection" style="display:none;">
                                        <label style="display:flex;align-items:center;gap:10px;cursor:pointer;padding:8px 0;">
                                            <div id="miComboToggle" onclick="toggleComboSwitch()" style="width:44px;height:24px;border-radius:12px;background:#CBD5E1;position:relative;cursor:pointer;transition:background 0.2s;">
                                                <div id="miComboKnob" style="width:20px;height:20px;border-radius:10px;background:#fff;position:absolute;top:2px;left:2px;transition:left 0.2s;box-shadow:0 1px 3px rgba(0,0,0,0.2);"></div>
                                            </div>
                                            <span id="miComboLabel" style="font-size:13px;font-weight:700;color:#64748B;">æ­¤å“é …ç‚ºå¥—é¤çµ„åˆ</span>
                                        </label>
                                        <div id="miComboEditor" style="display:none;margin-top:8px;">
                                            <div style="margin-bottom:10px;padding:12px;background:#EEF2FF;border-radius:10px;font-size:12px;color:#4F46E5;line-height:1.6;">
                                                ğŸ’¡ å¥—é¤æ¨¡å¼ä¸‹ï¼Œå®¢äººå¯å¾å¤šå€‹ç¾¤çµ„ä¸­å„é¸ä¸€é …çµ„åˆã€‚
                                            </div>
                                            <div id="miComboGroups"></div>
                                            <button type="button" onclick="addComboGroup()" style="width:100%;padding:10px;border:1.5px dashed #CBD5E1;border-radius:10px;background:transparent;font-size:12px;font-weight:700;color:#64748B;cursor:pointer;">+ æ–°å¢å¥—é¤ç¾¤çµ„</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- åº•éƒ¨æ“ä½œåˆ— -->
                        <div class="mi-drawer-footer">
                            <button id="miDeleteBtn" onclick="deleteMenuItem()" style="display:none;padding:14px 16px;border:1.5px solid #DC2626;border-radius:12px;background:#fff;color:#DC2626;font-size:13px;font-weight:700;cursor:pointer;">ğŸ—‘</button>
                            <button onclick="saveMenuItem()" id="miSaveBtn" style="flex:1;padding:14px;border:none;border-radius:12px;background:linear-gradient(135deg,#059669,#047857);color:#fff;font-size:15px;font-weight:800;cursor:pointer;transition:all 0.2s;">âœ… æ–°å¢å“é …</button>
                        </div>
                    </div>
                </div>

                <!-- è¨­å®š Tab -->
                <!-- å ±è¡¨ Tab -->
                <div id="rdReportTab" style="display:none;">
                    <!-- æ—¥æœŸé¸æ“‡ -->
                    <div style="display:flex;gap:8px;margin-bottom:12px;align-items:center;flex-wrap:wrap;">
                        <select id="reportRange" onchange="loadSalesReport()" style="padding:8px;border:1px solid #E2E8F0;border-radius:8px;font-size:13px;">
                            <option value="today">ä»Šæ—¥</option>
                            <option value="week">æœ¬é€±</option>
                            <option value="month" selected>æœ¬æœˆ</option>
                            <option value="custom">è‡ªè¨‚</option>
                        </select>
                        <input type="date" id="reportFrom" style="padding:8px;border:1px solid #E2E8F0;border-radius:8px;font-size:13px;display:none;">
                        <input type="date" id="reportTo" style="padding:8px;border:1px solid #E2E8F0;border-radius:8px;font-size:13px;display:none;">
                        <button onclick="loadSalesReport()" class="btn btn-primary" style="font-size:12px;padding:8px 14px;">æŸ¥è©¢</button>
                        <button onclick="exportSalesCSV()" style="padding:8px 14px;border:1px solid #E2E8F0;border-radius:8px;background:#fff;font-size:12px;cursor:pointer;">ğŸ“¥ åŒ¯å‡º</button>
                    </div>
                    <!-- æ‘˜è¦å¡ç‰‡ -->
                    <div style="display:grid;grid-template-columns:repeat(2,1fr);gap:8px;margin-bottom:14px;">
                        <div style="background:#DBEAFE;border-radius:10px;padding:12px;text-align:center;">
                            <div style="font-size:22px;font-weight:900;color:#1E40AF;" id="rptTotalRevenue">$0</div>
                            <div style="font-size:11px;color:#1E40AF;">ç‡Ÿæ¥­é¡</div>
                        </div>
                        <div style="background:#D1FAE5;border-radius:10px;padding:12px;text-align:center;">
                            <div style="font-size:22px;font-weight:900;color:#059669;" id="rptOrderCount">0</div>
                            <div style="font-size:11px;color:#059669;">è¨‚å–®æ•¸</div>
                        </div>
                        <div style="background:#FEF3C7;border-radius:10px;padding:12px;text-align:center;">
                            <div style="font-size:22px;font-weight:900;color:#92400E;" id="rptAvgOrder">$0</div>
                            <div style="font-size:11px;color:#92400E;">å¹³å‡å®¢å–®</div>
                        </div>
                        <div style="background:#F5F3FF;border-radius:10px;padding:12px;text-align:center;">
                            <div style="font-size:22px;font-weight:900;color:#7C3AED;" id="rptItemsSold">0</div>
                            <div style="font-size:11px;color:#7C3AED;">å“é …æ•¸</div>
                        </div>
                    </div>
                    <!-- æ¯æ—¥ç‡Ÿæ¥­é¡åœ–è¡¨ -->
                    <div style="background:#F8FAFC;border-radius:12px;padding:14px;margin-bottom:14px;">
                        <div style="font-weight:700;font-size:14px;margin-bottom:10px;">ğŸ“ˆ æ¯æ—¥ç‡Ÿæ¥­é¡</div>
                        <canvas id="dailyRevenueChart" height="200"></canvas>
                    </div>
                    <!-- ç†±éŠ·æ’è¡Œ -->
                    <div style="background:#F8FAFC;border-radius:12px;padding:14px;margin-bottom:14px;">
                        <div style="font-weight:700;font-size:14px;margin-bottom:10px;">ğŸ”¥ ç†±éŠ·æ’è¡Œ TOP 10</div>
                        <div id="rptTopItems"></div>
                    </div>
                    <!-- æ™‚æ®µåˆ†æ -->
                    <div style="background:#F8FAFC;border-radius:12px;padding:14px;margin-bottom:14px;">
                        <div style="font-weight:700;font-size:14px;margin-bottom:10px;">ğŸ• æ™‚æ®µåˆ†æ</div>
                        <canvas id="hourlyChart" height="180"></canvas>
                    </div>
                    <!-- è¨‚å–®é¡å‹åˆ†æ -->
                    <div style="background:#F8FAFC;border-radius:12px;padding:14px;margin-bottom:14px;">
                        <div style="font-weight:700;font-size:14px;margin-bottom:10px;">ğŸ“Š è¨‚å–®é¡å‹</div>
                        <div id="rptOrderTypes"></div>
                    </div>
                </div>

                <div id="rdSettingsTab" style="display:none;">
                    <!-- åŸºæœ¬è³‡æ–™ï¼ˆç”¨ç¾æœ‰ storeModal ç·¨è¼¯ï¼‰ -->
                    <div style="background:#F8FAFC;border-radius:12px;padding:14px;margin-bottom:14px;">
                        <div style="font-weight:700;font-size:14px;margin-bottom:10px;">ğŸ“‹ åŸºæœ¬è³‡æ–™</div>
                        <div id="rdStoreInfo" style="font-size:13px;color:#64748B;"></div>
                        <button onclick="editStore(rdCurrentStoreId)" style="margin-top:8px;padding:8px 16px;border:1px solid #E2E8F0;border-radius:8px;background:#fff;font-size:12px;cursor:pointer;">ğŸ“ ç·¨è¼¯åŸºæœ¬è³‡æ–™</button>
                    </div>
                    <!-- ç‡Ÿæ¥­æ™‚é–“ -->
                    <div style="background:#F8FAFC;border-radius:12px;padding:14px;margin-bottom:14px;">
                        <div style="font-weight:700;font-size:14px;margin-bottom:10px;">ğŸ• ç‡Ÿæ¥­æ™‚é–“</div>
                        <div id="rdBusinessHours"></div>
                        <button onclick="saveBusinessHours()" class="btn btn-success" style="margin-top:10px;font-size:13px;padding:10px 20px;">ğŸ’¾ å„²å­˜ç‡Ÿæ¥­æ™‚é–“</button>
                    </div>
                    <!-- LINE ç¾¤çµ„ -->
                    <div style="background:#F8FAFC;border-radius:12px;padding:14px;margin-bottom:14px;">
                        <div style="font-weight:700;font-size:14px;margin-bottom:10px;">ğŸ’¬ LINE ç¾¤çµ„æ¨æ’­</div>
                        <p style="font-size:11px;color:#94A3B8;margin-bottom:8px;">å°‡ Bot åŠ å…¥ç¾¤çµ„å¾Œï¼Œåœ¨ç¾¤çµ„ä¸­è¼¸å…¥ /groupid å–å¾—ç¾¤çµ„ ID</p>
                        <input type="text" id="rdLineGroupId" placeholder="LINE Group ID" style="width:100%;padding:10px;border:1px solid #E2E8F0;border-radius:8px;font-size:13px;box-sizing:border-box;">
                        <button onclick="saveLineGroupId()" class="btn btn-success" style="margin-top:8px;font-size:13px;padding:10px 20px;">ğŸ’¾ å„²å­˜</button>
                    </div>
                    <!-- æ¡Œè™Ÿ QR Code -->
                    <div style="background:#F8FAFC;border-radius:12px;padding:14px;margin-bottom:14px;">
                        <div style="font-weight:700;font-size:14px;margin-bottom:10px;">ğŸª‘ æ¡Œè™Ÿ QR Code</div>
                        <p style="font-size:11px;color:#94A3B8;margin-bottom:8px;">è‡ªå‹•ç”¢ç”Ÿæ¯æ¡Œçš„å…§ç”¨ QR Code + å¤–å¸¶ QR Codeï¼Œå¯åˆ—å°æˆæ¡Œä¸Šç«‹ç‰Œ</p>
                        <div style="display:flex;gap:8px;align-items:center;margin-bottom:10px;">
                            <label style="font-size:12px;white-space:nowrap;">æ¡Œæ•¸</label>
                            <input type="number" id="rdTableCount" min="1" max="50" value="6" style="width:80px;padding:8px;border:1px solid #E2E8F0;border-radius:8px;font-size:13px;">
                            <button onclick="generateTableQRCodes()" class="btn btn-primary" style="font-size:12px;padding:8px 14px;white-space:nowrap;">ç”¢ç”Ÿ QR Code</button>
                        </div>
                        <div id="rdTableQRList" style="display:none;">
                            <div style="display:flex;justify-content:flex-end;margin-bottom:8px;">
                                <button onclick="printTableQRCodes()" style="padding:6px 12px;border:1px solid #C7D2FE;border-radius:8px;background:#fff;font-size:11px;cursor:pointer;">ğŸ–¨ï¸ åˆ—å°å…¨éƒ¨</button>
                            </div>
                            <div id="rdTableQRGrid" style="display:grid;grid-template-columns:repeat(2,1fr);gap:10px;"></div>
                        </div>
                    </div>
                </div>

            </div>
        </div>

        <!-- æœƒå“¡è©³æƒ… / åŠ æ¸›é» Modal -->
        <div id="memberDetailModal" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.5);z-index:9999;align-items:center;justify-content:center;padding:20px;">
            <div style="background:#fff;border-radius:16px;width:100%;max-width:400px;max-height:80vh;overflow-y:auto;padding:24px;">
                <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;">
                    <h3 id="memberDetailTitle" style="margin:0;font-size:16px;">æœƒå“¡è©³æƒ…</h3>
                    <button onclick="closeMemberDetail()" style="border:none;background:none;font-size:20px;cursor:pointer;">âœ•</button>
                </div>

                <!-- æœƒå“¡è³‡è¨Š -->
                <div id="memberDetailInfo" style="background:#F8FAFC;border-radius:10px;padding:12px;margin-bottom:14px;font-size:13px;"></div>

                <!-- æ‰‹å‹•åŠ æ¸›é» -->
                <div style="background:#F0F9FF;border-radius:10px;padding:12px;margin-bottom:14px;">
                    <div style="font-weight:700;font-size:13px;margin-bottom:8px;">ğŸ¯ æ‰‹å‹•èª¿æ•´é»æ•¸</div>
                    <div style="display:flex;gap:8px;margin-bottom:8px;">
                        <button onclick="setAdjustType('add')" id="adjAddBtn" style="flex:1;padding:8px;border:2px solid #10B981;border-radius:8px;background:#D1FAE5;color:#065F46;font-size:13px;font-weight:700;cursor:pointer;">+ åŠ é»</button>
                        <button onclick="setAdjustType('deduct')" id="adjDeductBtn" style="flex:1;padding:8px;border:2px solid #E2E8F0;border-radius:8px;background:#fff;color:#64748B;font-size:13px;font-weight:700;cursor:pointer;">âˆ’ æ‰£é»</button>
                    </div>
                    <input type="number" id="adjPoints" min="1" placeholder="é»æ•¸" style="width:100%;padding:10px;border:1px solid #E2E8F0;border-radius:8px;font-size:14px;box-sizing:border-box;margin-bottom:8px;">
                    <input type="text" id="adjNote" placeholder="åŸå› å‚™è¨»ï¼ˆä¾‹ï¼šVIP è£œé»ã€æ´»å‹•è´ˆé»ï¼‰" style="width:100%;padding:10px;border:1px solid #E2E8F0;border-radius:8px;font-size:13px;box-sizing:border-box;margin-bottom:8px;">
                    <button onclick="submitAdjustPoints()" style="width:100%;padding:10px;border:none;border-radius:8px;background:#4F46E5;color:#fff;font-size:13px;font-weight:700;cursor:pointer;">ç¢ºèªèª¿æ•´</button>
                </div>

                <!-- é»‘åå–®æ“ä½œ -->
                <div id="memberBlacklistSection" style="background:#FEF2F2;border-radius:10px;padding:12px;margin-bottom:14px;">
                    <div style="font-weight:700;font-size:13px;margin-bottom:8px;">ğŸš« é»‘åå–®ç®¡ç†</div>
                    <div id="memberBlacklistStatus"></div>
                    <button id="blacklistToggleBtn" onclick="toggleBlacklist()" style="margin-top:8px;padding:8px 16px;border:none;border-radius:8px;font-size:12px;font-weight:600;cursor:pointer;"></button>
                </div>

                <!-- æ­¤å®¢æˆ¶çš„ç•°å‹•ç´€éŒ„ -->
                <div style="font-weight:700;font-size:13px;margin-bottom:8px;">ğŸ“’ ç•°å‹•ç´€éŒ„</div>
                <div id="memberTxList" style="max-height:200px;overflow-y:auto;font-size:12px;"></div>
            </div>
        </div>

        <!-- å•†åº—ç·¨è¼¯ Modal -->
        <div id="storeModal" style="display:none;position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.5);z-index:9999;align-items:center;justify-content:center;padding:20px;">
            <div style="background:#fff;border-radius:16px;width:100%;max-width:440px;max-height:90vh;overflow-y:auto;padding:24px;">
                <h3 id="storeModalTitle" style="margin-bottom:16px;">æ–°å¢å•†åº—</h3>
                <input type="hidden" id="storeEditId">
                <div class="form-group">
                    <label>å•†åº—åç¨± *</label>
                    <input type="text" id="storeNameInput" placeholder="ä¾‹ï¼šMike's Cafe" style="width:100%;padding:12px;border:1px solid #E2E8F0;border-radius:10px;font-size:14px;box-sizing:border-box;">
                </div>
                <div class="form-group">
                    <label>å•†åº—ä»£è™Ÿ</label>
                    <input type="text" id="storeSlugInput" placeholder="é¸å¡«ï¼Œä¾‹ï¼šmikes-cafeï¼ˆè‹±æ–‡å°å¯«ï¼‰" style="width:100%;padding:12px;border:1px solid #E2E8F0;border-radius:10px;font-size:14px;box-sizing:border-box;">
                    <div style="font-size:11px;color:#94A3B8;margin-top:4px;">é¡¯ç¤ºåœ¨é»é¤é€£çµä¸­ï¼Œç•™ç©ºæœƒè‡ªå‹•ç”¢ç”Ÿ</div>
                </div>
                <div class="form-group">
                    <label>å•†åº—é¡å‹</label>
                    <select id="storeTypeSelect" style="width:100%;padding:12px;border:1px solid #E2E8F0;border-radius:10px;font-size:14px;">
                        <option value="restaurant">é¤é£²</option>
                        <option value="service">æœå‹™æ¥­</option>
                        <option value="retail">é›¶å”®</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>èªªæ˜</label>
                    <input type="text" id="storeDescInput" placeholder="é¸å¡«" style="width:100%;padding:12px;border:1px solid #E2E8F0;border-radius:10px;font-size:14px;box-sizing:border-box;">
                </div>
                <div class="form-group">
                    <label>é›»è©±</label>
                    <input type="tel" id="storePhoneInput" placeholder="é¸å¡«" style="width:100%;padding:12px;border:1px solid #E2E8F0;border-radius:10px;font-size:14px;box-sizing:border-box;">
                </div>
                <div class="form-group">
                    <label>åœ°å€</label>
                    <input type="text" id="storeAddressInput" placeholder="é¸å¡«" style="width:100%;padding:12px;border:1px solid #E2E8F0;border-radius:10px;font-size:14px;box-sizing:border-box;">
                </div>
                <div class="form-group">
                    <label>å“ç‰Œå½¢è±¡åœ–ï¼ˆBannerï¼‰</label>
                    <div style="display:flex;gap:8px;align-items:center;">
                        <input type="url" id="storeBannerInput" placeholder="åœ–ç‰‡ç¶²å€æˆ–é»å³å´ä¸Šå‚³" style="flex:1;padding:12px;border:1px solid #E2E8F0;border-radius:10px;font-size:14px;box-sizing:border-box;">
                        <label style="padding:10px 16px;background:#4F46E5;color:#fff;border-radius:10px;font-size:13px;font-weight:600;cursor:pointer;white-space:nowrap;">
                            ğŸ“· ä¸Šå‚³
                            <input type="file" accept="image/*" onchange="uploadStoreImage(this,'banner')" style="display:none;">
                        </label>
                    </div>
                    <div id="storeBannerPreview" style="margin-top:8px;display:none;position:relative;display:inline-block;">
                        <img id="storeBannerPreviewImg" src="" style="max-width:100%;max-height:120px;border-radius:8px;border:1px solid #E2E8F0;">
                        <button onclick="clearStoreImage('banner')" style="position:absolute;top:-8px;right:-8px;width:24px;height:24px;border-radius:50%;border:none;background:#EF4444;color:#fff;font-size:14px;font-weight:700;cursor:pointer;display:flex;align-items:center;justify-content:center;box-shadow:0 2px 6px rgba(0,0,0,0.2);">âœ•</button>
                    </div>
                    <div style="font-size:11px;color:#94A3B8;margin-top:4px;">ğŸ“ å»ºè­°å°ºå¯¸ <b style="color:#64748B;">1200 Ã— 400px</b>ï¼ˆ3:1 æ©«å¹…ï¼‰ï¼Œæƒç¢¼å¾Œå…¨å¯¬é¡¯ç¤ºçš„å“ç‰Œå½¢è±¡åœ–</div>
                </div>
                <div class="form-group">
                    <label>Logo</label>
                    <div style="display:flex;gap:8px;align-items:center;">
                        <input type="url" id="storeLogoInput" placeholder="Logo åœ–ç‰‡ç¶²å€æˆ–é»å³å´ä¸Šå‚³" style="flex:1;padding:12px;border:1px solid #E2E8F0;border-radius:10px;font-size:14px;box-sizing:border-box;">
                        <label style="padding:10px 16px;background:#4F46E5;color:#fff;border-radius:10px;font-size:13px;font-weight:600;cursor:pointer;white-space:nowrap;">
                            ğŸ“· ä¸Šå‚³
                            <input type="file" accept="image/*" onchange="uploadStoreImage(this,'logo')" style="display:none;">
                        </label>
                    </div>
                    <div id="storeLogoPreview" style="margin-top:8px;display:none;position:relative;display:inline-block;">
                        <img id="storeLogoPreviewImg" src="" style="max-width:120px;max-height:120px;border-radius:12px;border:1px solid #E2E8F0;">
                        <button onclick="clearStoreImage('logo')" style="position:absolute;top:-8px;right:-8px;width:24px;height:24px;border-radius:50%;border:none;background:#EF4444;color:#fff;font-size:14px;font-weight:700;cursor:pointer;display:flex;align-items:center;justify-content:center;box-shadow:0 2px 6px rgba(0,0,0,0.2);">âœ•</button>
                    </div>
                </div>
                <div class="form-group">
                    <label>ä¸»é¡Œè‰²</label>
                    <input type="color" id="storeColorInput" value="#4F46E5" style="width:60px;height:40px;border:none;cursor:pointer;">
                </div>
                <div style="display:flex;gap:8px;margin-top:16px;">
                    <button onclick="closeStoreModal()" style="flex:1;padding:14px;border:1px solid #E2E8F0;border-radius:10px;background:#fff;font-weight:600;cursor:pointer;color:#64748B;">å–æ¶ˆ</button>
                    <button onclick="saveStore()" style="flex:1;padding:14px;border:none;border-radius:10px;background:linear-gradient(135deg,#059669,#10B981);color:#fff;font-weight:700;cursor:pointer;">ğŸ’¾ å„²å­˜</button>
                </div>
            </div>
        </div>

        <!-- èœå–®è¤‡è£½ Modal -->
        <div id="copyMenuModal" style="display:none;position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.5);z-index:9999;align-items:center;justify-content:center;padding:20px;">
            <div style="background:#fff;border-radius:16px;width:100%;max-width:400px;padding:24px;">
                <h3 style="margin-bottom:12px;">ğŸ“‹ è¤‡è£½èœå–®åˆ°å…¶ä»–å•†åº—</h3>
                <p style="font-size:12px;color:#EF4444;margin-bottom:12px;">æœƒè¦†è“‹ç›®æ¨™å•†åº—çš„ç¾æœ‰èœå–®</p>
                <div id="copyMenuTargets" style="margin-bottom:16px;"></div>
                <div style="display:flex;gap:8px;">
                    <button onclick="closeCopyMenuModal()" style="flex:1;padding:10px;border:1px solid #E2E8F0;border-radius:8px;background:#fff;font-size:13px;cursor:pointer;">å–æ¶ˆ</button>
                    <button onclick="executeCopyMenu()" style="flex:1;padding:10px;border:none;border-radius:8px;background:#4F46E5;color:#fff;font-weight:600;font-size:13px;cursor:pointer;">ç¢ºå®šè¤‡è£½</button>
                </div>
            </div>
        </div>

        <!-- å•†åº— QR Code Modal -->
        <div id="storeQRModal" style="display:none;position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.5);z-index:9999;align-items:center;justify-content:center;padding:20px;">
            <div style="background:#fff;border-radius:16px;width:100%;max-width:380px;padding:24px;text-align:center;">
                <h3 id="storeQRTitle" style="margin-bottom:12px;"></h3>
                <div id="storeQRCode" style="display:inline-block;margin:12px 0;"></div>
                <div style="margin-top:8px;">
                    <p id="storeQRUrl" style="font-size:11px;color:#64748B;word-break:break-all;margin-bottom:12px;"></p>
                    <button onclick="copyStoreUrl()" style="padding:8px 16px;border:1px solid #E2E8F0;border-radius:8px;background:#fff;font-size:12px;cursor:pointer;margin-right:6px;">ğŸ“‹ è¤‡è£½é€£çµ</button>
                    <button onclick="openStorePreview()" style="padding:8px 16px;border:none;border-radius:8px;background:#4F46E5;color:#fff;font-size:12px;cursor:pointer;">ğŸ‘ï¸ é è¦½é»é¤é </button>
                </div>
                <button onclick="closeStoreQR()" style="margin-top:16px;padding:10px 24px;border:1px solid #E2E8F0;border-radius:8px;background:#fff;font-size:13px;cursor:pointer;">é—œé–‰</button>
            </div>
        </div>

        <!-- è¨‚å–®æ˜ç´° Modal -->
        <div id="orderDetailModal" style="display:none;position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.5);z-index:9999;align-items:center;justify-content:center;padding:20px;">
            <div style="background:#fff;border-radius:16px;width:100%;max-width:420px;max-height:90vh;overflow-y:auto;padding:24px;">
                <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;">
                    <h3 id="odTitle" style="margin:0;">è¨‚å–®æ˜ç´°</h3>
                    <button onclick="closeOrderDetail()" style="background:none;border:none;font-size:24px;cursor:pointer;color:#94A3B8;">Ã—</button>
                </div>
                <div id="odContent"></div>
                <div id="odActions" style="display:flex;gap:8px;flex-wrap:wrap;margin-top:16px;"></div>
            </div>
        </div>

        <!-- ====== é ç´„ç®¡ç† ====== -->
        <div id="bookingMgrPage" class="page">
            <button class="btn btn-secondary" onclick="showPage('adminHomePage')" style="width:auto;margin-bottom:10px;">â† è¿”å›</button>
            <div class="checkin-page">
                <h2>ğŸ“… é ç´„ç®¡ç†</h2>
                <p style="color:#94A3B8;font-size:13px;margin-bottom:16px;">ç®¡ç†é ç´„æœå‹™ã€äººå“¡èˆ‡è¨‚å–®ï¼ˆç¾å®¹/ç¾ç”²/è¨ºæ‰€ç­‰ï¼‰</p>

                <!-- å•†åº—é¸æ“‡å™¨ -->
                <div class="form-group">
                    <label>é¸æ“‡å•†åº—</label>
                    <select id="bookingStoreSelect" onchange="loadBookingForStore()" style="font-size:14px;font-weight:700;padding:12px;">
                        <option value="">-- è«‹é¸æ“‡å•†åº— --</option>
                    </select>
                </div>

                <!-- å…§å®¹å€ -->
                <div id="bookingContent" style="display:none;">
                    <div style="background:#F8FAFC;border-radius:12px;padding:14px;margin-bottom:16px;">
                        <div style="display:flex;justify-content:space-between;align-items:center;">
                            <div>
                                <div style="font-size:13px;color:#64748B;">é ç´„é–‹é—œ</div>
                                <div style="font-size:11px;color:#94A3B8;margin-top:2px;">é—œé–‰å¾Œå®¢æˆ¶ç„¡æ³•æ–°å¢é ç´„</div>
                            </div>
                            <label style="position:relative;display:inline-block;width:48px;height:26px;margin:0;">
                                <input type="checkbox" id="bookingEnabled" onchange="toggleBookingEnabled()" style="opacity:0;width:0;height:0;">
                                <span style="position:absolute;cursor:pointer;top:0;left:0;right:0;bottom:0;background:#CBD5E1;border-radius:26px;transition:0.3s;"></span>
                                <span style="position:absolute;content:'';height:20px;width:20px;left:3px;bottom:3px;background:white;border-radius:50%;transition:0.3s;"></span>
                            </label>
                        </div>
                    </div>

                    <div style="display:flex;gap:8px;margin-bottom:16px;">
                        <div style="flex:1;background:#EFF6FF;border-radius:12px;padding:12px;text-align:center;">
                            <div style="font-size:11px;color:#3B82F6;">æœ¬é€±é ç´„</div>
                            <div id="bookingWeekCount" style="font-size:24px;font-weight:900;color:#1E40AF;margin-top:4px;">0</div>
                        </div>
                        <div style="flex:1;background:#FEF3C7;border-radius:12px;padding:12px;text-align:center;">
                            <div style="font-size:11px;color:#F59E0B;">å¾…ç¢ºèª</div>
                            <div id="bookingPendingCount" style="font-size:24px;font-weight:900;color:#92400E;margin-top:4px;">0</div>
                        </div>
                    </div>

                    <p style="text-align:center;color:#94A3B8;font-size:13px;margin-top:20px;">
                        ğŸ’¡ å®Œæ•´é ç´„è¨­å®šï¼ˆæœå‹™é …ç›®/äººå“¡/æ™‚æ®µï¼‰è«‹è‡³ booking.html é€²è¡Œç®¡ç†
                    </p>
                </div>
            </div>
        </div>

        <!-- ====== æœƒå“¡ç®¡ç† ====== -->
        <div id="memberMgrPage" class="page">
            <button class="btn btn-secondary" onclick="showPage('adminHomePage')" style="width:auto;margin-bottom:10px;">â† è¿”å›</button>
            <div class="checkin-page">
                <h2>ğŸ‘¥ æœƒå“¡ç®¡ç†</h2>
                <p style="color:#94A3B8;font-size:13px;margin-bottom:16px;">ç®¡ç†æœƒå“¡è³‡æ–™ã€é›†é»è¦å‰‡èˆ‡äº¤æ˜“è¨˜éŒ„</p>

                <!-- å•†åº—é¸æ“‡å™¨ -->
                <div class="form-group">
                    <label>é¸æ“‡å•†åº—</label>
                    <select id="memberStoreSelect" onchange="loadMembersForStore()" style="font-size:14px;font-weight:700;padding:12px;">
                        <option value="">-- è«‹é¸æ“‡å•†åº— --</option>
                    </select>
                </div>

                <!-- å…§å®¹å€ -->
                <div id="memberContent" style="display:none;">
                    <!-- é›†é»é–‹é—œ -->
                    <div style="background:#F8FAFC;border-radius:12px;padding:14px;margin-bottom:16px;">
                        <div style="display:flex;justify-content:space-between;align-items:center;">
                            <div>
                                <div style="font-size:13px;color:#64748B;">é›†é»åŠŸèƒ½</div>
                                <div style="font-size:11px;color:#94A3B8;margin-top:2px;">é—œé–‰å¾Œæ¶ˆè²»è€…çœ‹ä¸åˆ°é›†é»å€</div>
                            </div>
                            <label style="position:relative;display:inline-block;width:48px;height:26px;margin:0;">
                                <input type="checkbox" id="memberLoyaltyEnabled" onchange="toggleMemberLoyalty()" style="opacity:0;width:0;height:0;">
                                <span style="position:absolute;cursor:pointer;top:0;left:0;right:0;bottom:0;background:#CBD5E1;border-radius:26px;transition:0.3s;"></span>
                                <span style="position:absolute;content:'';height:20px;width:20px;left:3px;bottom:3px;background:white;border-radius:50%;transition:0.3s;"></span>
                            </label>
                        </div>
                    </div>

                    <!-- çµ±è¨ˆå¡ç‰‡ -->
                    <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:16px;">
                        <div style="background:#FFF7ED;border-radius:12px;padding:12px;text-align:center;">
                            <div style="font-size:11px;color:#EA580C;">ç¸½æœƒå“¡æ•¸</div>
                            <div id="memberTotalCount" style="font-size:24px;font-weight:900;color:#C2410C;margin-top:4px;">0</div>
                        </div>
                        <div style="background:#F0FDF4;border-radius:12px;padding:12px;text-align:center;">
                            <div style="font-size:11px;color:#059669;">VIP æœƒå“¡</div>
                            <div id="memberVipCount" style="font-size:24px;font-weight:900;color:#047857;margin-top:4px;">0</div>
                        </div>
                    </div>

                    <!-- æœå°‹æœƒå“¡ -->
                    <div class="form-group">
                        <input type="tel" id="memberSearchPhone" placeholder="ğŸ” è¼¸å…¥æ‰‹æ©Ÿè™Ÿç¢¼æœå°‹æœƒå“¡" oninput="searchMemberByPhone()" maxlength="10" style="font-size:14px;">
                    </div>

                    <div id="memberSearchResult" style="margin-top:12px;"></div>

                    <p style="text-align:center;color:#94A3B8;font-size:13px;margin-top:20px;">
                        ğŸ’¡ å®Œæ•´æœƒå“¡åˆ—è¡¨èˆ‡é›†é»è¦å‰‡è¨­å®šè«‹è‡³ã€ŒğŸ½ï¸ é¤é£²æ¥­ç®¡ç† â†’ ğŸ‘¥ æœƒå“¡ã€æŸ¥çœ‹
                    </p>
                </div>
            </div>
        </div>

    </div>
    <nav class="bottom-nav" id="bottomNav" style="display:none;">
        <a class="nav-item" onclick="window.location.href='index.html'">
            <span class="nav-icon">ğŸ </span>
            <span class="nav-label">é¦–é </span>
        </a>
        <a class="nav-item" onclick="window.location.href='schedule.html'">
            <span class="nav-icon">ğŸ“…</span>
            <span class="nav-label">ç­è¡¨</span>
        </a>
        <a class="nav-item" onclick="window.location.href='checkin.html?type=in'">
            <span class="nav-icon">ğŸ“</span>
            <span class="nav-label">æ‰“å¡</span>
        </a>
        <a class="nav-item" onclick="window.location.href='salary.html'">
            <span class="nav-icon">ğŸ’°</span>
            <span class="nav-label">è–ªè³‡</span>
        </a>
        <a class="nav-item active">
            <span class="nav-icon">âš™ï¸</span>
            <span class="nav-label">ç®¡ç†</span>
        </a>
    </nav>

    <script src="common.js"></script>
    <script type="module" src="modules/index.js"></script>
    <script type="module" src="admin_fixes.js"></script>
</body>
</html>
