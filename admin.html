<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ğŸ‘‘ ç®¡ç†å¾Œå° - å“¡å·¥æœå‹™ä¸­å¿ƒ</title>
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="loadingPage" class="loading-screen">
        <div class="spinner"></div>
        <p>ç³»çµ±è¼‰å…¥ä¸­...</p>
    </div>

    <div class="container">
        <!-- æ¬Šé™æª¢æŸ¥é é¢ -->
        <div id="permissionPage" class="page active">
            <div class="card">
                <div class="bind-header">
                    <span class="logo">ğŸ”</span>
                    <h2>ç®¡ç†å“¡æ¬Šé™æª¢æŸ¥</h2>
                    <p>æ­£åœ¨é©—è­‰æ‚¨çš„ç®¡ç†å“¡èº«ä»½...</p>
                </div>
                <div id="permissionStatus" class="status-box show info">
                    æª¢æŸ¥æ¬Šé™ä¸­...
                </div>
            </div>
        </div>

        <!-- ç®¡ç†å¾Œå°é¦–é  -->
        <div id="adminHomePage" class="page">
            <div class="user-card">
                <div class="user-info">
                    <div class="avatar" id="adminAvatar">ğŸ‘‘</div>
                    <div class="user-details">
                        <h2 id="adminName">ç®¡ç†å“¡</h2>
                        <p id="adminDept">ç³»çµ±ç®¡ç†</p>
                        <p id="adminId" style="font-size: 11px; opacity: 0.7;">ID: -</p>
                    </div>
                </div>
            </div>

            <div class="menu-grid">
                <div class="menu-item" onclick="showPage('bonusPage')">
                    <div class="icon">ğŸ</div><div class="label">å¹´çµ‚çé‡‘è©¦ç®—</div>
                </div>
                <div class="menu-item" onclick="showPage('locationPage')">
                    <div class="icon">ğŸ“</div><div class="label">åœ°é»ç®¡ç†</div>
                </div>
                <div class="menu-item" onclick="showPage('employeePage')">
                    <div class="icon">ğŸ‘¥</div><div class="label">å“¡å·¥ç®¡ç†</div>
                </div>
                <div class="menu-item" onclick="showPage('leaveApprovalPage')">
                    <div class="icon">âœ…</div><div class="label">è«‹å‡å¯©æ ¸</div>
                </div>
                <div class="menu-item" onclick="showPage('reportPage')">
                    <div class="icon">ğŸ“Š</div><div class="label">å ±è¡¨åŒ¯å‡º</div>
                </div>
                <div class="menu-item" onclick="window.location.href='index.html'">
                    <div class="icon">ğŸ </div><div class="label">è¿”å›é¦–é </div>
                </div>
            </div>
        </div>

        <!-- å¹´çµ‚çé‡‘è©¦ç®—é é¢ -->
        <div id="bonusPage" class="page">
            <button class="btn btn-secondary" onclick="showPage('adminHomePage')" style="width:auto;margin-bottom:10px;">â† è¿”å›</button>
            <div class="checkin-page">
                <h2>ğŸ å¹´çµ‚çé‡‘è©¦ç®—</h2>
                <div class="form-group">
                    <label>è©¦ç®—å¹´åº¦</label>
                    <select id="bonusYear" onchange="loadAllBonusStats()">
                        <option value="2026">2026</option>
                        <option value="2025">2025</option>
                    </select>
                </div>
                
                <div class="lunch-summary">
                    <h3 style="margin-bottom:15px;">ğŸ“ˆ è©¦ç®—æ‘˜è¦</h3>
                    <div class="stat-row"><span>ç¬¦åˆè³‡æ ¼äººæ•¸</span><span id="eligibleCount">0</span></div>
                    <div class="stat-row"><span>æœªç¬¦åˆè³‡æ ¼äººæ•¸</span><span id="ineligibleCount">0</span></div>
                    <div class="stat-row"><span>ç¸½é ç®—</span><span id="totalBudget">0</span></div>
                    <div class="stat-row"><span>å¹³å‡çé‡‘</span><span id="avgBonus">0</span></div>
                </div>

                <div id="bonusList" style="margin-top:20px;">
                    <p style="text-align:center;color:#666;">è¼‰å…¥ä¸­...</p>
                </div>
            </div>
        </div>

        <!-- åœ°é»ç®¡ç†é é¢ -->
        <div id="locationPage" class="page">
            <button class="btn btn-secondary" onclick="showPage('adminHomePage')" style="width:auto;margin-bottom:10px;">â† è¿”å›</button>
            <div class="checkin-page">
                <h2>ğŸ“ åœ°é»ç®¡ç†</h2>
                
                <div class="lunch-summary">
                    <h3 style="margin-bottom:10px;">ğŸ“ ç›®å‰æ‰“å¡åœ°é»</h3>
                    <div id="adminLocationList">
                        <p style="color:#666;text-align:center;">è¼‰å…¥ä¸­...</p>
                    </div>
                </div>

                <div class="binding-card" style="margin-top: 20px;">
                    <h3 style="margin-bottom:15px;">â• æ–°å¢åœ°é»</h3>
                    <div class="form-group">
                        <label>åœ°é»åç¨±</label>
                        <input type="text" id="adminNewLocName" placeholder="ä¾‹å¦‚ï¼šå°åŒ—åˆ†åº—">
                    </div>
                    <div class="form-group">
                        <label>æ‰“å¡åŠå¾‘ (å…¬å°º)</label>
                        <input type="number" id="adminNewLocRadius" value="300">
                    </div>
                    <div class="form-group">
                        <label>åº§æ¨™ (ç·¯åº¦, ç¶“åº¦)</label>
                        <div style="display:flex; gap:10px;">
                            <input type="text" id="adminNewLocLat" placeholder="ç·¯åº¦" readonly>
                            <input type="text" id="adminNewLocLng" placeholder="ç¶“åº¦" readonly>
                        </div>
                        <button class="btn btn-primary" onclick="getCurrentGPSForAdmin()" style="margin-top:10px; font-size:14px; padding:10px;">
                            ğŸ“ æŠ“å–ç›®å‰ä½ç½®
                        </button>
                    </div>
                    <button class="btn btn-success" onclick="addNewLocationForAdmin()">ğŸ’¾ å„²å­˜æ–°åœ°é»</button>
                </div>
            </div>
        </div>

        <!-- å“¡å·¥ç®¡ç†é é¢ -->
        <div id="employeePage" class="page">
            <button class="btn btn-secondary" onclick="showPage('adminHomePage')" style="width:auto;margin-bottom:10px;">â† è¿”å›</button>
            <div class="checkin-page">
                <h2>ğŸ‘¥ å“¡å·¥ç®¡ç†</h2>
                <div class="form-group">
                    <label>æœå°‹å“¡å·¥</label>
                    <input type="text" id="employeeSearch" placeholder="è¼¸å…¥å§“åæˆ–å·¥è™Ÿ" onkeyup="searchEmployees()">
                </div>
                <div id="employeeList">
                    <p style="text-align:center;color:#666;">è¼‰å…¥ä¸­...</p>
                </div>
            </div>
        </div>

        <!-- è«‹å‡å¯©æ ¸é é¢ -->
        <div id="leaveApprovalPage" class="page">
            <button class="btn btn-secondary" onclick="showPage('adminHomePage')" style="width:auto;margin-bottom:10px;">â† è¿”å›</button>
            <div class="checkin-page">
                <h2>âœ… è«‹å‡å¯©æ ¸</h2>
                <div class="tabs">
                    <button class="tab-btn active" onclick="switchLeaveTab('pending')">å¾…å¯©æ ¸</button>
                    <button class="tab-btn inactive" onclick="switchLeaveTab('approved')">å·²é€šé</button>
                    <button class="tab-btn inactive" onclick="switchLeaveTab('rejected')">å·²æ‹’çµ•</button>
                </div>
                <div id="leaveApprovalList">
                    <p style="text-align:center;color:#666;">è¼‰å…¥ä¸­...</p>
                </div>
            </div>
        </div>

        <!-- å ±è¡¨åŒ¯å‡ºé é¢ -->
        <div id="reportPage" class="page">
            <button class="btn btn-secondary" onclick="showPage('adminHomePage')" style="width:auto;margin-bottom:10px;">â† è¿”å›</button>
            <div class="checkin-page">
                <h2>ğŸ“Š å ±è¡¨åŒ¯å‡º</h2>
                <div class="menu-grid">
                    <div class="menu-item" onclick="exportReport('attendance')">
                        <div class="icon">ğŸ“ˆ</div><div class="label">å‡ºå‹¤å ±è¡¨</div>
                    </div>
                    <div class="menu-item" onclick="exportReport('leave')">
                        <div class="icon">ğŸ“</div><div class="label">è«‹å‡å ±è¡¨</div>
                    </div>
                    <div class="menu-item" onclick="exportReport('bonus')">
                        <div class="icon">ğŸ</div><div class="label">çé‡‘å ±è¡¨</div>
                    </div>
                    <div class="menu-item" onclick="exportReport('lunch')">
                        <div class="icon">ğŸ±</div><div class="label">ä¾¿ç•¶å ±è¡¨</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="common.js"></script>
    <script>
        let currentAdminEmployee = null;
        let allBonusStats = [];

        // é é¢åˆ‡æ›åŠŸèƒ½
        function showPage(id) {
            document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            
            if(id==='bonusPage') loadAllBonusStats();
            if(id==='locationPage') renderAdminLocationList();
            if(id==='employeePage') loadEmployeeList();
            if(id==='leaveApprovalPage') loadLeaveApprovals('pending');
        }

        // æª¢æŸ¥ç®¡ç†å“¡æ¬Šé™
        async function checkAdminPermission() {
            const statusEl = document.getElementById('permissionStatus');
            
            try {
                console.log('ğŸ” é–‹å§‹æª¢æŸ¥ç®¡ç†å“¡æ¬Šé™...');
                
                const initialized = await initializeLiff();
                console.log('ğŸ“± LIFF åˆå§‹åŒ–çµæœ:', initialized);
                
                if (!initialized) {
                    showStatus(statusEl, 'error', 'âŒ LIFF åˆå§‹åŒ–å¤±æ•—');
                    return;
                }

                console.log('ğŸ‘¤ LIFF Profile:', liffProfile);
                console.log('ğŸ”‘ LINE User ID:', liffProfile?.userId);

                const { data, error } = await sb.from('employees')
                    .select('*')
                    .eq('line_user_id', liffProfile.userId)
                    .eq('role', 'admin')
                    .eq('is_active', true)
                    .single();

                console.log('ğŸ“Š è³‡æ–™åº«æŸ¥è©¢çµæœ:', { data, error });

                if (error || !data) {
                    console.error('âŒ æ¬Šé™æª¢æŸ¥å¤±æ•—:', error);
                    showStatus(statusEl, 'error', 'âŒ æ‚¨æ²’æœ‰ç®¡ç†å“¡æ¬Šé™<br>éŒ¯èª¤: ' + (error?.message || 'æ‰¾ä¸åˆ°å“¡å·¥è³‡æ–™'));
                    
                    // é¡¯ç¤ºè©³ç´°è³‡è¨Š
                    setTimeout(() => {
                        showStatus(statusEl, 'info', 'ğŸ” è©³ç´°è³‡è¨Š:<br>LINE ID: ' + (liffProfile?.userId || 'æœªçŸ¥') + '<br>è«‹ç¢ºèªè³‡æ–™åº«ä¸­çš„ role æ¬„ä½ç‚º admin');
                    }, 2000);
                    
                    setTimeout(() => {
                        window.location.href = 'index.html';
                    }, 5000);
                    return;
                }

                console.log('âœ… æ¬Šé™é©—è­‰é€šé:', data);
                currentAdminEmployee = data;
                updateAdminInfo(data);
                showStatus(statusEl, 'success', 'âœ… æ¬Šé™é©—è­‰é€šé');
                
                setTimeout(() => {
                    showPage('adminHomePage');
                }, 1000);

            } catch (err) {
                console.error('ğŸ’¥ æ¬Šé™æª¢æŸ¥ç•°å¸¸:', err);
                showStatus(statusEl, 'error', 'âŒ æ¬Šé™æª¢æŸ¥å¤±æ•—: ' + err.message);
            }
        }

        // æ›´æ–°ç®¡ç†å“¡è³‡è¨Š
        function updateAdminInfo(data) {
            document.getElementById('adminName').textContent = data.name;
            document.getElementById('adminDept').textContent = `ç³»çµ±ç®¡ç†`;
            document.getElementById('adminId').textContent = `ID: ${data.employee_number}`;
            
            const avatar = document.getElementById('adminAvatar');
            if(liffProfile.pictureUrl) {
                avatar.style.backgroundImage = `url(${liffProfile.pictureUrl})`;
                avatar.style.backgroundSize = 'cover'; 
                avatar.textContent = 'ğŸ‘‘';
            } else {
                avatar.textContent = 'ğŸ‘‘';
            }
        }

        // è¼‰å…¥æ‰€æœ‰å“¡å·¥çé‡‘çµ±è¨ˆ
        async function loadAllBonusStats() {
            const yearEl = document.getElementById('bonusYear');
            const listEl = document.getElementById('bonusList');
            if (!yearEl || !listEl) return;

            const year = parseInt(yearEl.value);
            listEl.innerHTML = '<p style="text-align:center;">è¼‰å…¥ä¸­...</p>';

            try {
                const { data, error } = await sb.rpc('get_all_year_end_stats', { p_year: year });
                
                if (error) throw error;
                
                allBonusStats = data || [];
                
                // è¨ˆç®—çµ±è¨ˆæ‘˜è¦
                const eligible = allBonusStats.filter(emp => emp.bonus_status === 'ç¬¦åˆè³‡æ ¼');
                const ineligible = allBonusStats.filter(emp => emp.bonus_status !== 'ç¬¦åˆè³‡æ ¼');
                const totalBudget = eligible.reduce((sum, emp) => sum + (emp.suggested_bonus || 0), 0);
                
                document.getElementById('eligibleCount').textContent = eligible.length;
                document.getElementById('ineligibleCount').textContent = ineligible.length;
                document.getElementById('totalBudget').textContent = `$${totalBudget.toLocaleString()}`;
                document.getElementById('avgBonus').textContent = eligible.length > 0 ? 
                    `$${Math.round(totalBudget / eligible.length).toLocaleString()}` : '$0';

                // æ¸²æŸ“è©³ç´°åˆ—è¡¨
                let html = '';
                allBonusStats.forEach(emp => {
                    const isEligible = emp.bonus_status === 'ç¬¦åˆè³‡æ ¼';
                    html += `
                        <div class="attendance-item ${isEligible ? 'normal' : 'late'}">
                            <div class="date">
                                ${emp.name} (${emp.employee_number})
                                <span class="badge ${isEligible ? 'badge-success' : 'badge-warning'}">
                                    ${isEligible ? 'ç¬¦åˆ' : 'æœªç¬¦åˆ'}
                                </span>
                            </div>
                            <div class="details">
                                <span>${emp.department || '-'}</span>
                                <span>$${(emp.suggested_bonus || 0).toLocaleString()}</span>
                            </div>
                            <div style="font-size:12px;color:#666;margin-top:5px;">
                                ${emp.bonus_status} | å‡ºå‹¤${emp.attendance_rate}% | é²åˆ°${emp.late_count}æ¬¡
                            </div>
                            <button class="btn-danger" onclick="adjustBonus('${emp.employee_id}', '${emp.name}', ${emp.suggested_bonus || 0})" style="margin-top:5px;font-size:12px;">
                                èª¿æ•´çé‡‘
                            </button>
                        </div>
                    `;
                });
                
                listEl.innerHTML = html || '<p style="text-align:center;">ç„¡è³‡æ–™</p>';

            } catch (err) {
                console.error(err);
                listEl.innerHTML = '<p style="text-align:center;color:red;">è¼‰å…¥å¤±æ•—</p>';
            }
        }

        // èª¿æ•´çé‡‘
        function adjustBonus(employeeId, employeeName, currentBonus) {
            const newBonus = prompt(`èª¿æ•´ ${employeeName} çš„çé‡‘é‡‘é¡\nç›®å‰: $${currentBonus.toLocaleString()}\nè«‹è¼¸å…¥æ–°é‡‘é¡ (0 è¡¨ç¤ºå–æ¶ˆ):`);
            
            if (newBonus === null) return;
            
            const bonusAmount = parseInt(newBonus);
            if (isNaN(bonusAmount) || bonusAmount < 0) {
                showToast('âŒ è«‹è¼¸å…¥æœ‰æ•ˆçš„é‡‘é¡');
                return;
            }
            
            // é€™è£¡éœ€è¦å¯¦ä½œæ›´æ–°çé‡‘çš„é‚è¼¯
            showToast(`âœ… ${employeeName} çš„çé‡‘å·²èª¿æ•´ç‚º $${bonusAmount.toLocaleString()}`);
            loadAllBonusStats(); // é‡æ–°è¼‰å…¥åˆ—è¡¨
        }

        // ç®¡ç†å“¡åœ°é»ç®¡ç†åŠŸèƒ½
        function getCurrentGPSForAdmin() {
            getCurrentGPSForSetting(); // ä½¿ç”¨ common.js ä¸­çš„å‡½æ•¸
        }

        function addNewLocationForAdmin() {
            addNewLocation(); // ä½¿ç”¨ common.js ä¸­çš„å‡½æ•¸
        }

        function renderAdminLocationList() {
            renderLocationList(); // ä½¿ç”¨ common.js ä¸­çš„å‡½æ•¸
        }

        // è¼‰å…¥å“¡å·¥åˆ—è¡¨
        async function loadEmployeeList() {
            const listEl = document.getElementById('employeeList');
            if (!listEl) return;

            try {
                const { data, error } = await sb.from('employees')
                    .select('*')
                    .eq('is_active', true)
                    .order('department', { ascending: true });

                if (error) throw error;

                let html = '';
                data.forEach(emp => {
                    const roleBadge = emp.role === 'admin' ? 
                        '<span class="badge badge-warning">ç®¡ç†å“¡</span>' : 
                        '<span class="badge badge-success">å“¡å·¥</span>';
                    
                    html += `
                        <div class="attendance-item">
                            <div class="date">
                                ${emp.name} ${roleBadge}
                            </div>
                            <div class="details">
                                <span>${emp.employee_number}</span>
                                <span>${emp.department || '-'}</span>
                            </div>
                            <div style="font-size:12px;color:#666;margin-top:5px;">
                                ${emp.position || '-'} | åˆ°è·: ${emp.hire_date || '-'}
                            </div>
                            <div style="margin-top:5px;">
                                <button class="btn-danger" onclick="changeEmployeeRole('${emp.id}', '${emp.name}', '${emp.role}')" style="font-size:12px;padding:5px 10px;">
                                    ${emp.role === 'admin' ? 'å–æ¶ˆç®¡ç†å“¡' : 'è¨­ç‚ºç®¡ç†å“¡'}
                                </button>
                            </div>
                        </div>
                    `;
                });

                listEl.innerHTML = html || '<p style="text-align:center;">ç„¡å“¡å·¥è³‡æ–™</p>';

            } catch (err) {
                console.error(err);
                listEl.innerHTML = '<p style="text-align:center;color:red;">è¼‰å…¥å¤±æ•—</p>';
            }
        }

        // è®Šæ›´å“¡å·¥è§’è‰²
        async function changeEmployeeRole(employeeId, employeeName, currentRole) {
            const newRole = currentRole === 'admin' ? 'user' : 'admin';
            const action = currentRole === 'admin' ? 'å–æ¶ˆç®¡ç†å“¡æ¬Šé™' : 'è¨­ç‚ºç®¡ç†å“¡';
            
            if (!confirm(`ç¢ºå®šè¦ ${action} çµ¦ ${employeeName} å—ï¼Ÿ`)) return;

            try {
                const { error } = await sb.from('employees')
                    .update({ role: newRole })
                    .eq('id', employeeId);

                if (error) throw error;

                showToast(`âœ… ${employeeName} çš„è§’è‰²å·²æ›´æ–°`);
                loadEmployeeList();

            } catch (err) {
                console.error(err);
                showToast('âŒ æ›´æ–°å¤±æ•—: ' + err.message);
            }
        }

        // æœå°‹å“¡å·¥
        function searchEmployees() {
            const searchTerm = document.getElementById('employeeSearch').value.toLowerCase();
            const items = document.querySelectorAll('#employeeList .attendance-item');
            
            items.forEach(item => {
                const text = item.textContent.toLowerCase();
                item.style.display = text.includes(searchTerm) ? 'block' : 'none';
            });
        }

        // è«‹å‡å¯©æ ¸åŠŸèƒ½
        function switchLeaveTab(status) {
            // æ›´æ–° tab æŒ‰éˆ•ç‹€æ…‹
            document.querySelectorAll('#leaveApprovalPage .tab-btn').forEach(btn => {
                btn.className = 'tab-btn inactive';
            });
            event.target.className = 'tab-btn active';
            
            loadLeaveApprovals(status);
        }

        async function loadLeaveApprovals(status) {
            const listEl = document.getElementById('leaveApprovalList');
            if (!listEl) return;

            try {
                const { data, error } = await sb.from('leave_requests')
                    .select(`
                        *,
                        employees!inner(name, employee_number, department)
                    `)
                    .eq('status', status)
                    .order('created_at', { ascending: false });

                if (error) throw error;

                let html = '';
                data.forEach(request => {
                    const typeMap = { 'annual': 'ç‰¹ä¼‘', 'sick': 'ç—…å‡', 'personal': 'äº‹å‡', 'compensatory': 'è£œä¼‘' };
                    
                    html += `
                        <div class="attendance-item">
                            <div class="date">
                                ${request.employees.name} - ${typeMap[request.leave_type]}
                            </div>
                            <div class="details">
                                <span>${request.start_date} ~ ${request.end_date}</span>
                                <span>${request.created_at.split('T')[0]}</span>
                            </div>
                            <div style="font-size:12px;color:#666;margin-top:5px;">
                                ${request.reason}
                            </div>
                            ${status === 'pending' ? `
                                <div style="margin-top:5px;display:flex;gap:5px;">
                                    <button class="btn-success" onclick="approveLeave('${request.id}', 'approved')" style="flex:1;font-size:12px;padding:5px;">
                                        âœ… é€šé
                                    </button>
                                    <button class="btn-danger" onclick="approveLeave('${request.id}', 'rejected')" style="flex:1;font-size:12px;padding:5px;">
                                        âŒ æ‹’çµ•
                                    </button>
                                </div>
                            ` : ''}
                        </div>
                    `;
                });

                listEl.innerHTML = html || '<p style="text-align:center;">ç„¡${status === 'pending' ? 'å¾…å¯©æ ¸' : status === 'approved' ? 'å·²é€šé' : 'å·²æ‹’çµ•'}çš„è«‹å‡ç”³è«‹</p>';

            } catch (err) {
                console.error(err);
                listEl.innerHTML = '<p style="text-align:center;color:red;">è¼‰å…¥å¤±æ•—</p>';
            }
        }

        // å¯©æ ¸è«‹å‡
        async function approveLeave(requestId, newStatus) {
            try {
                const { error } = await sb.from('leave_requests')
                    .update({ 
                        status: newStatus,
                        approver_id: currentAdminEmployee.id,
                        approved_at: new Date().toISOString()
                    })
                    .eq('id', requestId);

                if (error) throw error;

                showToast(`âœ… è«‹å‡ç”³è«‹å·²${newStatus === 'approved' ? 'é€šé' : 'æ‹’çµ•'}`);
                loadLeaveApprovals('pending');

            } catch (err) {
                console.error(err);
                showToast('âŒ å¯©æ ¸å¤±æ•—: ' + err.message);
            }
        }

        // åŒ¯å‡ºå ±è¡¨
        function exportReport(type) {
            showToast(`ğŸ“Š æ­£åœ¨æº–å‚™${type === 'attendance' ? 'å‡ºå‹¤' : type === 'leave' ? 'è«‹å‡' : type === 'bonus' ? 'çé‡‘' : 'ä¾¿ç•¶'}å ±è¡¨...`);
            // é€™è£¡å¯ä»¥å¯¦ä½œå¯¦éš›çš„å ±è¡¨åŒ¯å‡ºåŠŸèƒ½
            setTimeout(() => {
                showToast('âœ… å ±è¡¨åŠŸèƒ½é–‹ç™¼ä¸­ï¼Œæ•¬è«‹æœŸå¾…');
            }, 1000);
        }

        // é é¢è¼‰å…¥å®Œæˆå¾Œæª¢æŸ¥æ¬Šé™
        window.addEventListener('load', async () => {
            if (typeof initializeLiff === 'undefined') {
                console.error('initializeLiff å‡½æ•¸æœªå®šç¾©ï¼Œè«‹æª¢æŸ¥ common.js æ˜¯å¦æ­£ç¢ºè¼‰å…¥');
                return;
            }
            
            checkAdminPermission();
        });
    </script>
</body>
</html>
